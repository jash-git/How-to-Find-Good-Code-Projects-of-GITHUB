define("pages/video_plugin/base.js",[],function(){
"use strict";
var t=0,e=function(t,e){
var n=function(){};
n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.uber=e.prototype;
},n=function(){
this.player=null;
};
return n.prototype.setPlayer=function(t){
this.player=t;
},n.prototype.setBlockEvt=function(t){
this.player._setBlockPlugin(t,this);
},n.prototype.setUnblockEvt=function(t){
this.player._setBlockPlugin(t,null);
},n.prototype.recv=function(e){
var n=this[e+"Handler"];
if("function"==typeof n){
var o=n.apply(this,arguments);
return"undefined"==typeof o||null===o?t:o;
}
return t;
},{
Class:n,
inherit:e,
BASE_BITSET:t
};
});define("pages/video_error.html.js",[],function(){
return'<#if(errType==1){#>\n<div style="<#if(typeof width!=\'undefined\'){#>width:<#=width#>px;<#}#><#if(typeof height!=\'undefined\'){#>height:<#=height#>px;<#}#>" class="wrp_pop_tips wx_video_error_box js_error_box">\n   <div class="wx_video_error_msg js_error_area">\n       <p role="heading"><#=msg#></p>\n       <#if(!is_mp_video){#>\n       <i class="wx_video_error_code">错误码：<#=errcode#></i>\n       <#}#>\n       <# if(showBtn){ #>\n       <a class="wx_video_error_msg_btn js_video_errormsg_btn" role="button" href="javascript:void(0);">\n           <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAqCAMAAADhynmdAAAAQlBMVEUAAACcnJycnJycnJyoqKicnJycnJycnJycnJycnJyfn5+cnJydnZ2enp6kpKSdnZ2cnJyenp6cnJycnJycnJybm5t8KrXMAAAAFXRSTlMAyeb3CNp3tJRvHIEtJhBgqztWRJ+p5TqGAAABCklEQVQ4y5WTi27DIAxFAUMhgTzX8/+/urB2pdKI0x0pSoRuruyLbf7gF3PBaDE6X44LyY0D1SJQsfd9PpMM/CJx60v8SmV1HMSi1lKyA1n0jnwWSO08l04uJbxpBmTrpDtbGB6fmxC6Tc4BHv9aZDJdJsHW9w43Jez9x8T5M4l31WZsJn2bsYY+nUum2lQkGIVANPZ4FCLWOJImSTgjZE2SkU9crmu57mj9JBc93Qzj9R1d3HSG5bN5MRsnUzcGKK8Ns02z+Da7rYQE4bUE2PG1C6kVnkCyf0pwX8/jwbyxCLhcHpKTFkvkwK3pRmXtRrVFoTGYLvN+t0EUl0qrRaF1pFBz0anp/ptvNB4SY1XDAVMAAAAASUVORK5CYII=" alt="" class="wx_video_error_refresh">\n           刷新       </a>\n       <# } #>\n   </div>\n   <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADkAAAA5CAMAAAC7xnO3AAAAY1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+aRQ2gAAAAIXRSTlMAOx20pMJbzBQNTDGTh2ohLCZmeUF2hEmXCFdxUquef4yHE17nAAACnklEQVRIx9WW2xqiIBSFRc1AUATJU1a+/1MOm0NYKvnNXM260ZLftRcbqCQinOLI0yiY/iXKuUZPjx5Fk+6RhF1yHiVF0wC6IZfr9fqIkpRqdNyQ9AoiUU8g+YZ8Xn96YmNKvkhkLMskKgEo/yJzaxkXeZsGsjeWKEIFU/FBZgA+D5yEwGtTgR0J18lYUvdcLZ1YkUjLf+a0saYYSG/J3Hury+WSkTCjCETtF6Mvd8QGJMZSWIfsAlKhWGRl5zQ1ZNBDgy/zzvvFavWUK7SyTRs+rsiUZS/4LHIHyo8VgBx7vDkKx2WhPS7dD1Q6cNlu2dTa0gMys4bz/vJR6ph8ADgcVcSVUkfnhzJTc6gRj8fbCOHk30UI2KC+V4gKjskJQqC5frFHli0kafogFIfFkAXVCSqdAFVR8pmtVCWiXCtaarbWpGtQAYx7sjf2GCbfjFRQpH7lTLucveSMBE7+Z6VqViT2/PVs0d7hPk9TUcTaUuVaT8k/f/v6SXOgyG7InZaSvM8vj/309LrbvpSAORDH2/kWGyHhm/u5AYUc8qdFBRRrsV749bRv6I5x1OY50GZUUxQz9aGplAXZcOQ1DL3vwsTyvHQ2YWgjZV2rDTmxYRjUuoBvcQDr7QRLBiiNzJ4BawG3FLtTmEMGBigTRyC2oIKht1vbwLWrKmXKBZal+yApDGhm4q5JCVdNdrZeQBe8B44WnE2NGmxrR1bCvMugHdkhSwMWI9wjIGeosnPlJmNrst6PQrpeFkBSyAmkdD016DYqAVC6HHcNtnCPgazcuytAd5IqB/qYtq4bkP7vnEaL3W4KH9/HhKBAKl8XFUlMIWYIek4hZgh6UtjHBLVA4pPkCKRf9jOQ5Kwp1UvPDyb3qkPJaRG8Ln7f8Q8Bki/Kj5IYnQAAAABJRU5ErkJggg==" class="wx_video_error_loading js_video_errormsg_loading" style="display:none;">\n</div>\n<#}else{#>\n<div style="<#if(typeof width!=\'undefined\'){#>width:<#=width#>px;<#}#><#if(typeof height!=\'undefined\'){#>height:<#=height#>px;<#}#>" class="wx_video_msg_primary js_error_box">\n  <div class="wx_video_msg_primary_inner">\n    <i class="weui-icon-info weui-icon_msg"></i>\n    <p class="wx_video_msg_primary_text"><#=msg#></p>\n  </div>\n</div>\n<#}#>\n';
});function _typeof(e){
return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e;
}
define("new_video/player.js",["page/pages/video.css","biz_common/utils/string/html.js","biz_wap/zepto/zepto.js","biz_wap/zepto/event.js","biz_wap/zepto/touch.js","biz_wap/jsapi/log.js","biz_common/dom/event.js","new_video/player.html.js","biz_wap/utils/device.js","new_video/ctl.js","biz_common/tmpl.js","pages/iframe_communicate.js","a/a_utils.js","biz_common/utils/url/parse.js","pages/version4video.js","biz_wap/utils/wapsdk.js","biz_common/base64.js","biz_wap/jsapi/core.js","new_video/plugin/util.js","biz_wap/utils/jsmonitor_report.js","common/utils.js","biz_wap/utils/ajax.js"],function(e){
"use strict";
function t(){
o(),i();
}
function i(){
y.on("onNetWorkChange",function(e){
if(console.log("networkchanged",e),e.networkType||(e.networkType=e.netType),e.networkType&&e.simType)try{
if(!parent.window.lastNetworkType&&window.networkType&&window.simType)parent.window.lastNetworkType={
networkType:window.networkType,
simType:window.simType
};else if(T.isObjectValueEqual(parent.window.lastNetworkType,e))return;
if(window.simType=e.simType,window.networkType=e.networkType,T.isMobileNetwork(e.networkType)&&1!==e.simType&&parent.window.lastNetworkType&&("wifi"===parent.window.lastNetworkType.networkType||T.isNoneNetwork(parent.window.lastNetworkType.networkType)))for(var t in parent.window.__MpPlayers){
var i=parent.window.__MpPlayers[t];
i._g.isUserPause=!1,i._g.pauseNetType=null,!i.isPlay()&&!i.isEnd()&&i.isPause()&&i.hasBeginPlay()?(i._g.isUserPause=!0,
i._g.pauseNetType=parent.window.lastNetworkType.networkType):i.isPlay()&&("wifi"===parent.window.lastNetworkType.networkType&&T.isVideoNeedFlowNotice(i.opt.flow,2)||T.isNoneNetwork(parent.window.lastNetworkType.networkType)&&T.isVideoNeedFlowNotice(i.opt.flow,4))&&i.__showFlowNotice_1();
}
parent.window.lastNetworkType=e;
}catch(o){}
});
}
function o(){
document.webkitVisibilityState?document.addEventListener("webkitvisibilitychange",s,!1):document.msVisibilityState?document.addEventListener("msvisibilitychange",s,!1):document.visibilityState&&document.addEventListener("visibilitychange",s,!1);
try{
parent.window.__MpBindExitFullPage||(parent.window.__MpBindExitFullPage=!0,b.listenMpPageAction(function(e){
if(e&&"onExitMpVideoFullPage"===e.action)for(var t in parent.window.__MpPlayers)if(Object.prototype.hasOwnProperty.call(parent.window.__MpPlayers,t)){
var i=parent.window.__MpPlayers[t];
if(i&&i.__isInFullScreen){
var o=i.opt&&i.opt.extinfo&&i.opt.extinfo.vid?i.opt.extinfo.vid:"";
if(o&&o===e.videoVid){
if(i.__isInFullScreen=!1,!_.os.android){
var n=1*e.videoCurrTime;
n=-1===n?0/0:n;
var a=i.__getDuration();
parseInt(a,10)===parseInt(n,10)||n>a?i.videoEnd():i.play4outer(n,{
triggerEvent:!1
}),i.onFullScreenChange({
state:!1,
type:"jsapi"
});
}
break;
}
}
}
}));
}catch(e){
l.info("videoplayer jsapi ExitFullPage error:"+e);
}
}
function n(){
if("hidden"in document)return"hidden";
for(var e=["webkit","moz","ms","o"],t=0;t<e.length;t++)return e[t]+"Hidden"in document,
e[t]+"Hidden";
return null;
}
function a(){
var e=n();
return e?document[e]:!1;
}
function r(e,t){
t?(e.setAttribute("muted",!0),e.muted=!0):(e.removeAttribute("muted"),e.muted=!1);
}
function s(){
if(a())try{
for(var e in parent.window.__MpPlayers){
var t=parent.window.__MpPlayers[e];
if(t.hasBeginPlay()&&t.isPlay()){
t.pause4outer(),C.visibilityPausePlayer=t;
break;
}
}
}catch(i){}else{
var o=C.visibilityPausePlayer;
o&&o.hasBeginPlay()&&!o.isEnd()&&(o.play4outer(),C.visibilityPausePlayer=null);
}
}
e("page/pages/video.css"),e("biz_common/utils/string/html.js"),e("biz_wap/zepto/zepto.js"),
e("biz_wap/zepto/event.js"),e("biz_wap/zepto/touch.js");
var l=e("biz_wap/jsapi/log.js"),d=e("biz_common/dom/event.js"),u=e("new_video/player.html.js"),_=e("biz_wap/utils/device.js"),h=e("new_video/ctl.js"),c=e("biz_common/tmpl.js"),p=e("pages/iframe_communicate.js"),g=e("a/a_utils.js"),f=e("biz_common/utils/url/parse.js"),m=e("pages/version4video.js"),v=e("biz_wap/utils/wapsdk.js"),w=e("biz_common/base64.js"),y=e("biz_wap/jsapi/core.js"),T=e("new_video/plugin/util.js"),S=e("biz_wap/utils/jsmonitor_report.js"),b=e("common/utils.js"),P=(e("biz_common/utils/url/parse.js"),
e("biz_wap/utils/ajax.js")),j=18e4,C={
visibilityPausePlayer:null
};
try{
C._debug=window.parent.window.location.href.indexOf("&_debug=1")>0;
}catch(B){
C._debug=!1;
}
var F=3e3;
t();
var k=function(e){
C._debug&&console.log(e);
},M=navigator.userAgent,x=function(){
return!0;
}(),D=(-1!==M.indexOf("Safari")&&-1!==M.indexOf("Version")&&-1==M.indexOf("Android"),
function(){
return!!_.browser.M1;
}()),E=function(e,t){
var i=document.createElement("div");
return e in i.style?(i.style[e]=t,i.style[e]===t):!1;
},I=function(e){
var t=0,i=0,o=0;
.5>e&&(e=0),e=Math.ceil(e);
var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),o=e-3600*t-60*i;
return 0!=t?(10>t&&(t="0"+t),t+=":"):t="",10>i&&(i="0"+i),10>o&&(o="0"+o),t+i+":"+o;
},N=!_.canSupportVideo,V=function(e){
var t=this,i=$(e.container);
"undefined"==typeof e.videoReportType&&(e.videoReportType=-1),e.width=e.width||300,
e.height=e.height||300,e.videoWidth=e.videoWidth||0,e.videoHeight=e.videoHeight||0,
e.duration=e.duration||0,e.videoFit=!1,e.isVideoSharePage=e.isVideoSharePage||!1;
var o={
needToFit:!1,
supportObjectFit:!1,
os:_.os
};
if(e.width&&e.height&&e.videoWidth&&e.videoHeight){
var n=Math.abs(e.width/e.height-e.videoWidth/e.videoHeight);
.1>=n&&(o.needToFit=!0,E("objectFit","fill")&&(o.supportObjectFit=!0,e.videoFit=!0));
}
e.ratio=e.ratio||e.width/e.height,e.autoplay=!!e.autoplay||!1,e.flow=e.flow&&parseFloat(e.flow)||0,
this.opt=e,this.id=e.id=+new Date+"_"+Math.floor(Math.random()*Math.floor(+new Date)),
this.opt.jsapiFullScreen!==!0&&(this.opt.jsapiFullScreen=!1),this.opt.canShareVideo!==!0&&(this.opt.canShareVideo=!1),
this.opt.pauseShowControll!==!0&&(this.opt.pauseShowControll=!1),this.__iosPreloadPause=!1,
this.__iosPreloadPlayFlag=!1,this.__iosIsRealPreload=!1,this.__forcePause=!1,this.__hasFuncControllBar=!0,
this.__dragTimes=[],this.__play_total_time=0,this.__last_playtime=0,this.__always_hide_loading=e.always_hide_loading||!1,
this.__last_loadingtime=0,this.__loadingCountFlag=null,this.__userplaytime=!1,this._playingBufferingStartTime=null,
this._g={
oriSrc:this.opt.src,
timeupdateCacheCount:3,
serialTimeupdateCache:[],
resetShowingLoadingTimeoutId:null,
showingLoadingTimeoutId:null,
statusDefine:{
init:1,
play:1,
pause:1,
loading:1,
end:1,
error:1
},
subStatusDefine:{
init:1,
play:1,
playing:1,
waiting:1,
stalled:1,
seeking:1,
seeked:1,
preload:1
},
status:"init",
subStatus:"init",
triggerTimeupdateLog:!0,
isUserPause:!1,
pauseNetType:null,
hasReportBeginPlay:!1,
coverBase64:"",
loadingCoverBase64:!1,
touchForwarding:!1,
jsapiFullScreenId:null,
jsapiFullScreenErrCnt:0,
jsapiFullScreenErrLimit:2,
iosPreloadTmpPlay:!1
},e._mustHideFullScreen=D,e.display=e.autoHide?"none":"block",e.ad_muted_btn=e.ad_muted_btn||!1,
e.videoCrossOrigin=e.jsapiFullScreen&&_.os.ios?!0:!1;
var a=c.tmpl(u,e);
i.append(a);
var r=this.container=$("#js_mpvedio_"+this.id);
this.$video=r.find("video");
var s=this.video=this.$video[0];
this.__initData(),this.__initVideo();
var l=e.src;
if(!l)return this.changeStatus({
status:"error",
subStatus:"5"
}),void this.__triggerOutside("error",{
errorcode:5
});
if(s.setAttribute("origin_src",l),N)return r.find(".js_btn_play").attr("href",l).show(),
this.__loadedHandler(),void this.__bindBtnEvent();
parent.window&&!parent.window.lastNetworkType&&window.networkType&&window.simType&&(parent.window.lastNetworkType={
networkType:window.networkType,
simType:window.simType
});
var d=e.plugins||[];
this._blockPlugin={};
for(var h=0,p=d.length;p>h;++h){
var g=d[h];
g.setPlayer(this),!!g.init&&g.init();
}
this.plugins=d,this._trigger("afterCheckVideoFit",o),this._trigger("loading",e),
this._defineEvent(),this.__bindBtnEvent(),this.__bindVideoEvent(),this._addPostmessageListener();
try{
parent.window.__MpPlayers||(parent.window.__MpPlayers={}),parent.window.__MpPlayers[this.id]=this;
}catch(f){}
this.opt.canShareVideo&&setTimeout(function(){
t.getCoverBase64({
callback:function(){}
});
},1e3);
};
return $.extend(V.prototype,{
_jsapiLog:function(e){
var t=["vid:","videosrc:"];
this.opt&&this.opt.extinfo&&this.opt.extinfo.vid&&(t[0]+=this.opt.extinfo.vid),this.$video&&this.$video[0]&&this.$video[0].src&&(t[1]+=this.$video[0].src),
l.info("videoplayer "+e+";"+t.join(";"));
},
__triggerOutside:function(){
var e=this.opt,t=arguments,i=t[0],o=this,n=this.video;
if(i){
i=i.substr(0,1).toUpperCase()+i.substr(1);
var a=e["on"+i];
"function"==typeof a&&a.apply(this,t),"BeginPlay"!=i||null!=o.__replaySec&&0!=o.__replaySec||!_.os.ios||(n.currentTime=.1);
}
},
__errorHandler:function(){
this.video.removeAttribute("src");
},
__loadingHandler:function(e){
this.showLoading(),this._trigger("ready",e);
},
__readyHandler:function(e){
var t=this.opt.src;
m.proxyPreloadExper()&&m.proxyPreloadExper().isUsePreload&&this.setSrc(t),this._trigger("loaded",e);
},
__loadedHandler:function(e){
return(e&&e.autoplay||this.opt.autoplay||window.__auto_play__)&&m.device.inWechat?(window.__auto_play__=!1,
this.videoCtlReport({
step:15
}),this._g.hasReportBeginPlay=!0,void this._trigger("readyBeginPlay",e)):void this._setBeginPlayStatus();
},
__readyBeginPlayHandler:function(e){
m.proxyPreloadExper()&&m.proxyPreloadExper().isUsePreload||this.dontReset||this.setSrc(this.opt.src),
this.dontReset&&(this.dontReset=!1),this._trigger("beginPlay",e);
},
__beginPlayHandler:function(){
function e(e,t){
e.__firstPlayStart=+new Date,e.__userplaytime=!0,t.find(".js_video_poster").show(),
e.showCover(),t.find(".js_video_play_controll").hide(),e.__hasBeginPlay=!0,e.showLoading("firstTime"),
e.showControllBar(),e.opt.flowNotice&&e.__firstLoadedFlowNoticeJudge();
}
N&&(location.href=this.opt.src);
var t=this.container,i=this,o=this.video,n=void 0;
setTimeout(function(){
try{
i.__continueSec&&(i.__replaySec=i.__continueSec,i.__continueSec=null),i._jsapiLog("set continue:"+i.__replaySec),
n=o.play(),"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.then(function(){
e(i,t);
}).catch(function(e){
("AbortError"===e.name||"NotAllowedError"===e.name)&&(i._setBeginPlayStatus(),i.dontReset=!0,
S.setSum(114217,16,1));
}):e(i,t);
}catch(a){
i._jsapiLog("play error");
}
},1);
},
__replayHandler:function(){
this.videoCtlReport({
step:9
});
var e=this.video.muted;
this.setSrc(this.src,this.video.preload,!0),this.triggerMuted(e),this._afterReplay();
},
__endHandler:function(){
this.container.find(".js_btn_play_aria").data("status","3").removeClass("video_playing"),
this.hideControllBar(),this.hideTouchForward(),this._hidePlayControllBar(),this.__hasBeginPlay=!1,
this.__canplay=!1;
},
__hideControllTimeoutCallback:function(){
return this.__onTouch?void this.__hideControllTimeout():void(this.isPlay()&&this.hideControllBar());
},
__touchVideoHandler:function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this,e=this.opt;
if(e.blockTouchVideo||this.__onTouch||this.opt.pauseShowControll&&this.isPause()||this.__userplaytime)return!1;
if(!t.__canplay||t.isEnd()&&e.hideControllBarAtEnd)return void t.hideControllBar();
var i=t.container.find(".js_controll");
e.isShow===!0||"none"==i.css("display")?t.showControllBar():t.hideControllBar();
var o=t.container.find(".js_video_flow");
"none"!==o.css("display")&&t._g.isUserPause===!1&&t.__hideFlowNotice(),t.__hideControllTimeout();
},
__hideControllTimeout:function(){
var e=this;
this.__touchVideoTimeoutHandler&&clearTimeout(this.__touchVideoTimeoutHandler),this.__touchVideoTimeoutHandler=setTimeout(function(){
e.__hideControllTimeoutCallback();
},F);
},
__initData:function(){
this.log={
hasended:0,
lastsec:0,
duration:0,
video_error:0
},this.__hasBeginPlay=!1,this.__canplay=!1,this._playingBufferingStartTime=null,
this.__userplaytime=!1,this.__hasscroll=!1,this.__replaySec=null,this.__playQueue=[];
},
__initVideo:function(){
var e=this.opt,t=this.video;
t.addEventListener("contextmenu",function(e){
e.preventDefault();
},!1),t.hasAttribute("controls")&&t.removeAttribute("controls"),t.setAttribute("webkit-playsinline","isiPhoneShowPlaysinline"),
t.setAttribute("playsinline","isiPhoneShowPlaysinline"),e.loop&&t.setAttribute("loop",e.loop),
e.muted&&r(t,!0),this.$video.off("loadedmetadata durationchange"),this.__hasVideoDurationchange=!1;
},
__getDuration:function(){
var e=this.opt,t=this.video,i=t?t.duration:null;
return i&&1!=i?i:e.duration;
},
__videoDurationchange:function(){
var e=this;
if(!e.__hasVideoDurationchange){
var t=this.video,i=this.opt,o=this.container;
if(1/0!=t.duration&&t.duration>0&&1!=t.duration)e.duration=t.duration,e.__hasVideoDurationchange=!0;else{
if(!i.duration)return!1;
e.duration=i.duration,e.__hasVideoDurationchange=!0;
}
e.log.duration=e.duration,e.duration>>=0,o.find(".js_total_time").text(I(e.duration)),
this.__hasFuncControllBar&&o.find(".js_progress_bar,.js_total_time").show();
var n=+new Date,a=n-e.log.loadwait_start;
e.log.loadwait=a,e._trigger("durationchange",{
loadwait:a
});
}
},
__startCountTime:function(){
var e=this,t=this.video;
t&&null===e.__last_playtime&&(e.__last_playtime=t.currentTime);
},
__endCountTime:function(){
var e=this,t=this.video;
t&&t.currentTime>e.__last_playtime&&null!==e.__last_playtime&&(e.__play_total_time+=t.currentTime-e.__last_playtime,
e.__last_playtime=null);
},
__bindVideoEvent:function(){
var e=this.$video,t=this,i=this.container,o=i.find(".js_switch"),n=this.video;
e.off("timeupdate").on("timeupdate",function(){
if(t.__forcePause===!0)return void k(t.id+":timeupdate __forcePause return");
if(t.__hasBeginPlay&&!t.__canplay)return t.showLoading(),!1;
n=t.video,null!=t.__replaySec&&(k(t.id+":timeupdate __replaySec"),n.pause(),n.currentTime=t.__replaySec,
t.__last_playtime=t.__replaySec,n.play(),t.__replaySec=null),t.__videoDurationchange();
var e=n.currentTime;
if(e>0){
t.__startCountTime(),t._addSerialTimeupdate(),"loading"===t._g.status&&"seeking"===t._g.subStatus||!t._checkPlayBySerialTimeupdate()||(t.hideLoading(),
t._g.touchForwarding||t.hideTouchForward());
var i=t.__getDuration();
t.__onTouch||(t.__setControllBar(e/i),t.__setPlayTime(e)),t.hideCover(),t._trigger("timeupdate",{
currentTime:e
}),t.afterFirstLoaded();
}
}),e.off("canplay").on("canplay",function(){
null!=t.__replaySec&&(n.currentTime=1*(1*t.__replaySec).toFixed(4),t.__last_playtime=t.__replaySec,
t.__replaySec=null),t.__canplay=!0,t._trigger("canplay");
}),e.off("ended").on("ended",function(){
k("player inner isend:"+t.isEnd()),t.isEnd()&&t.videoEnd();
}),e.off("emptied").on("emptied",function(){}),t.waitingHandlerTimer=null;
var a=0;
e.off("stalled").on("stalled",function(){
if(this.__hasBeginPlay&&!t.waitingHandlerTimer){
t.changeStatus({
status:"loading",
subStatus:"stalled"
}),t.showLoading();
var e=n.src,i=n.readyState,o=n.error;
0!=i||o&&0!=o.code||(clearTimeout(t.waitingHandlerTimer),t.waitingHandlerTimer=null,
t.showLoading(),t.showCover(),n.pause(),n.src=e,n.load(),n.play(),k(t.id+":stalled"));
}
}),e.on("seeked",function(){
t.__onTouch||t.opt.jsapiFullScreen&&t.__isInFullScreen||(t.changeStatus({
status:"loading",
subStatus:"seeked"
}),n.play()),k("video seeked event");
}),e.off("seeking").on("seeking",function(){
k("seeking,__hasBeginPlay:"+t.__hasBeginPlay),t.__hasBeginPlay&&(t.changeStatus({
status:"loading",
subStatus:"seeking"
}),t.showLoading());
}),e.off("waiting").on("waiting",function(){
if(k("waiting,__hasBeginPlay:"+t.__hasBeginPlay),t.__hasBeginPlay){
t.changeStatus({
status:"loading",
subStatus:"waiting"
}),t.showLoading(),t._jsapiLog("waiting counting begin"),t.loadingCountFlag||clearTimeout(t.loadingCountFlag),
t.__last_loadingtime=n.currentTime,t.loadingCountFlag=setTimeout(function(){
n.currentTime===t.__last_loadingtime&&(t.changeStatus({
status:"error",
subStatus:"6"
}),t.__triggerOutside("error",{
errorcode:6
}));
},j),clearTimeout(t.waitingHandlerTimer),t.waitingHandlerTimer=null;
var e=0;
try{
for(var i in parent.window.__MpPlayers)if(parent.window.__MpPlayers.hasOwnProperty(i)&&e++,
e>1)break;
}catch(o){}
e>1&&t.__forcePause===!1&&(t.waitingHandlerTimer=setTimeout(function(){
if(t.__forcePause!==!0){
var e=n.error;
if(0==n.readyState&&(!e||0==e.code)){
clearTimeout(t.waitingHandlerTimer),t.waitingHandlerTimer=null;
var i=n.src;
t.showLoading(),t.showCover(),n.pause(),n.src=i,a++,n.load(),n.play(),k(t.id+":waitingHandlerTimer");
}
}
},1e4)),t._trigger("waiting");
}
}),e.off("play playing").on("play playing",function(e){
return t.__forcePause===!0||t._g.iosPreloadTmpPlay?void k(t.id+":play playing __forcePause return"):(t.changeStatus({
status:"play",
subStatus:e.type
}),setTimeout(function(){
t.adVideoStatus="play";
},10),k(t.id+":play playing"),o.removeClass("switch_on"),o.addClass("switch_off"),
t._hidePlayControllBar(),t.__startCountTime(),void t._trigger("play"));
}),e.off("pause").on("pause",function(){
t._g.iosPreloadTmpPlay||(k(t.id+":video pause event"),t.changeStatus({
status:"pause",
subStatus:""
}),setTimeout(function(){
t.adVideoStatus="pause";
},10),o.addClass("switch_on"),o.removeClass("switch_off"),!t.__canplay||t.isEnd()||t.__onTouch?t._hidePlayControllBar():(t.hideControllBar(),
t._showPlayControllBar()),t.__endCountTime(),t._trigger("pause"));
}),e.off("error").on("error",function(){
var e=void 0;
t.video.error&&(e=t.video.error.code),t.changeStatus({
status:"error",
subStatus:e||""
});
var i="/mp/ad_video_report?action=report_video_play_error",o=encodeURIComponent(t.video.baseURI);
P({
type:"GET",
dataType:"json",
timeout:3e4,
url:i+"&errorCode="+e+"&videoUrl="+o,
success:function(){},
error:function(){}
}),t._trigger("error",{
errorcode:e
});
}),e.off("webkitbeginfullscreen webkitendfullscreen webkitfullscreenchange mozfullscreenchange fullscreenchange").on("webkitbeginfullscreen webkitendfullscreen webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){
var i=void 0;
i="webkitbeginfullscreen"==e.type?!0:"webkitendfullscreen"==e.type?!1:document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,
t.onFullScreenChange({
state:i,
type:"h5"
});
});
},
_defineEvent:function(){
var e=this;
this._event={
progressBarMousemove:function(t){
e.__hasFuncControllBar&&e.__onTouch&&e._pointerMoveHandler({
x:t.pageX||t.clientX,
y:t.pageY||t.clientY,
e:t
});
},
progressBarMouseup:function(t){
return e.__hasFuncControllBar&&e.__onTouch?(e._pointerUpHandler({
x:t.pageX||t.clientX,
y:t.pageY||t.clientY,
e:t
}),!1):void 0;
},
progressBarTouchmove:function(t){
if(e.__hasFuncControllBar&&e.__onTouch){
var i=t.changedTouches[0];
e._pointerMoveHandler({
x:i.pageX,
y:i.pageY,
e:t
});
}
},
progressBarTouchend:function(t){
if(e.__hasFuncControllBar&&e.__onTouch){
var i=t.changedTouches[0];
return e._pointerUpHandler({
x:i.pageX,
y:i.pageY,
e:t
}),!1;
}
},
broadcastPlay:function(t){
t.id!==e.id&&e.__hasBeginPlay&&!e.isEnd()&&e.pause4outer();
}
};
},
_addPostmessageListener:function(){
p.addListener({
type:"broadcastPlay",
func:this._event.broadcastPlay
});
},
__bindBtnEvent:function(){
function e(){
if(N)return location.href=o.opt.src,!1;
o.changeStatus({
status:"loading",
subStatus:"preload"
});
var e=2;
o._g.hasReportBeginPlay?e=9:window.cgiData&&"0"==window.cgiData.media_source&&(e=11),
o.videoCtlReport({
step:e
}),o._g.hasReportBeginPlay=!0,o._trigger("readyBeginPlay");
}
function t(){
var t=o.opt.canMePlay;
"function"==typeof t?t(e):e();
}
function i(){
o.isPlay()?(o.videoCtlReport({
step:12
}),o.pause4outer()):o.play4outer();
}
var o=this,n=this.opt,a=(n.extinfo,this.container),r=(this.video,a.find(".js_video_play_controll"),
a.find(".js_btn_play")),s=a.find(".js_btn_play_aria"),l=a.find(".js_video_poster"),u=a.find(".js_switch"),_=a.find(".js_progress_bar"),h=a.find(".js_controll"),c=(a.find(".js_played_bar"),
a.find(".js_page_video")),p=a.find(".js_full_mask"),g=a.find(".js_video_pause_controll"),f=a.find(".js_full_screen_control"),m=a.find(".js_loading"),v=a.find(".js_share_btn");
this.opt.canShareVideo&&(v[0]&&d.tap(v[0],function(){
o.callJsapiShareVideo({
action:"shareEmbedMpVideo"
});
}),d.longtap(this.container[0],function(e){
h[0].contains(e.target)||e.target===h[0]||o.callJsapiShareVideo({
action:"longPressEmbedMpVideo"
});
})),d.on(g[0],"tap",".js_btn_pause",function(){
o.play4outer();
});
var w=void 0,y=void 0,T=0,b=0,P=0,j=o.__getDuration(),C=0,B=0,F=1,k=window.user_uin||0,M=0!==k&&Math.floor(k/100)%1e3<F,D=!1,E=void 0,I=void 0,V=0,L=!0,H=!1,z=null;
c.on("touchstart",function(e){
1==e.targetTouches.length&&o.isPlay()&&(n.blockTouchVideo||(z&&(clearTimeout(z),
z=null),E=w=new Date,I=y={
x:e.targetTouches[0].clientX,
y:e.targetTouches[0].clientY
},o._g.touchForwarding=!1,H=!0,L=!0,B=C=o.getCurTime()));
}),c.on("touchmove",function(e){
if(L&&1==e.targetTouches.length&&o.isPlay()&&!n.blockTouchVideo){
var t=new Date,i=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY,r=Math.abs(i-I.x),s=Math.abs(a-I.y);
if(H&&(s>=10||s>r))return L=!1,void(H=!1);
z&&(clearTimeout(z),z=null),H=!1,o._g.touchForwarding=!0;
var l=t-w,d=i-y.x,u=a-y.y,_=Math.sqrt(Math.pow(d,2)+Math.pow(u,2))+P,h=Math.min(Math.ceil(_/l),6);
b=Math.floor(.1*_+.2*h*h*h)*Math.ceil(j/500),P=0==b?_:0,0>d&&(b=-b);
var c=180*Math.atan2(u,d)/Math.PI;
o._g.touchForwarding||(c>=-30&&30>=c&&++T,(c>=150&&180>=c||c>=-180&&-150>=c)&&--T,
(T>=4||-4>=T)&&(5>=_?T=0:(V=Math.max(V,h),o._g.touchForwarding=!0))),o._g.touchForwarding&&(C+=b,
0>C&&(C=0),C>j&&(C=1*j),o.__setForwardBar(C),e.preventDefault()),y={
x:i,
y:a
},w=t;
}
}),c.on("touchend",function(e){
if(o._g.touchForwarding){
if(z=setTimeout(function(){
o.play(C);
},0),M&&(S.setSum(28307,29,1),!D)){
var t=(new Date,{
x:e.changedTouches[0].clientX,
y:e.changedTouches[0].clientY
}),i=t.x-I.x,n=t.y-I.y,a=parseInt(Math.sqrt(Math.pow(i,2)+Math.pow(n,2))),r=parseInt(180*Math.atan2(n,i)/Math.PI);
r>=-30&&30>=r||r>=150&&180>=r||r>=-180&&-150>=r||S.setSum(28307,35,1),S.setSum(28307,31,1),
S.setSum(28307,33,a),S.setSum(28307,34,V),D=!0;
}
o._seekReport(),o._trigger("handDragComplete",{
playTime:C,
startDragVideoTime:B
}),e.preventDefault();
}
o.hideTouchForward(),b=0,H=!1,o._g.touchForwarding=!1,L=!0,T=0;
}),c.on("touchmove MSPointerMove pointermove mousemove",function(e){
o.isInFullScreen()&&!x&&e.preventDefault();
}),d.tap(c[0],function(e){
e.target===h[0]||h[0].contains(e.target)||e.target===v[0]||o.isEnd()||o.isPause()||o._g.touchForwarding||o._trigger("touchVideo");
}),d.tap(p[0],function(){
o.isEnd()||o._trigger("touchVideo");
}),p.on("touchmove MSPointerMove pointermove mousemove",function(e){
o.isInFullScreen()&&!x&&e.preventDefault();
}),d.tap(s[0],function(){
var e=$(this),n=1*e.data("status");
0==n?(e.addClass("video_playing").data("status","1"),t()):1==n?(e.removeClass("video_playing").data("status","2"),
i()):2==n?(e.addClass("video_playing").data("status","1"),i()):3==n&&(e.addClass("video_playing").data("status","1"),
o._trigger("ariaReplay"));
}),d.tap(r[0],function(){
t();
}),d.tap(m[0],function(){
o._trigger("touchVideo");
}),d.tap(u[0],function(){
i();
}),o.__onTouch=!1,_.on("mousedown",function(e){
o.__hasFuncControllBar&&(h.off("mousemove",o._event.progressBarMousemove).on("mousemove",o._event.progressBarMousemove),
l.off("mousemove",o._event.progressBarMousemove).on("mousemove",o._event.progressBarMousemove),
$(document.body).off("mouseup").on("mouseup",o._event.progressBarMouseup),o._pointerDownHandler({
x:e.pageX||e.clientX,
y:e.pageY||e.clientY,
e:e
}));
}),_.on("touchstart",function(e){
if(o.__hasFuncControllBar){
_.off("touchmove",o._event.progressBarTouchmove).on("touchmove",o._event.progressBarTouchmove),
_.off("touchend",o._event.progressBarTouchend).on("touchend",o._event.progressBarTouchend);
var t=e.changedTouches[0];
o._pointerDownHandler({
e:e,
x:t.pageX,
y:t.pageY
});
}
}),d.tap(f[0],function(e){
return o.isInFullScreen()?x&&o.exitFullScreen():x&&(S.setSum(28307,56,1),o.enterFullScreen()),
e.preventDefault(),!1;
});
},
hideTouchForward:function(){
this.container.find(".js_forward").addClass("none");
},
__firstLoadedFlowNoticeJudge:function(){
if(m.device.inWechat&&parent.window.lastNetworkType&&parent.window.lastNetworkType.networkType&&parent.window.lastNetworkType.simType&&T.isMobileNetwork(parent.window.lastNetworkType.networkType)&&1!==parent.window.lastNetworkType.simType){
var e=void 0;
e=this.opt.flow<100&&this.opt.flow>0?T.isVideoNeedFlowNotice(this.opt.flow,1):T.isVideoNeedFlowNotice(this.opt.flow,5),
e&&(this.opt.flow<100&&this.opt.flow>0?this.__showFlowNotice_1():this.__showFlowNotice_2(this.opt.flow));
}
},
__showFlowNotice_1:function(){
this.videoCtlReport({
step:16,
noticeType:1
}),this._trigger("flowNotice",{
flow:parseInt(1024*this.opt.flow),
noticeType:1
}),this.__flowNoticeTimer&&(clearTimeout(this.__flowNoticeTimer),this.__flowNoticeTimer=null);
var e=this.container.find(".js_video_flow").removeClass("flow_fade_out");
this.container.find(".js_flow_notice_1").show(),this.container.find(".js_flow_notice_2").hide(),
e.show(),e.addClass("flow_fade_out");
},
__showFlowNotice_2:function(e){
this.videoCtlReport({
step:16,
noticeType:2
}),this._trigger("flowNotice",{
flow:parseInt(1024*this.opt.flow),
noticeType:2
}),this.__flowNoticeTimer&&(clearTimeout(this.__flowNoticeTimer),this.__flowNoticeTimer=null),
this.container.find(".js_flow_notice_2").show(),this.container.find(".js_flow_notice_1").hide(),
this.container.find(".js_video_flow_num").html(e+"M"),this.container.find(".js_video_flow").removeClass("flow_fade_out").show(),
this.container.find(".js_video_flow").addClass("flow_fade_out");
},
__hideFlowNotice:function(){
this.__flowNoticeTimer&&(clearTimeout(this.__flowNoticeTimer),this.__flowNoticeTimer=null),
this.container.find(".js_video_flow").hide();
},
_pointerDownHandler:function(e){
this.__onTouch=!0,this.showControllBar(),this.progressBarSeekData={
x1:e.x,
y1:e.y,
startTime:this.video.currentTime
},this.pause(),e.e.preventDefault();
},
_pointerMoveHandler:function(e){
var t=this.container.find(".js_played_bar"),i=this.container.find(".js_progress_bar");
this.__onTouch=!0,this.__has_drag=!0,this.progressBarSeekData.x2=e.x,this.progressBarSeekData.y2=e.y;
var o=t.offset(),n=i.width(),a=(e.x-o.left)/n,r=this.__getDuration(),s=1*(r*a).toFixed(4);
s>r&&(s=r-1);
var l=!1;
"undefined"==typeof this.progressBarSeekData.dragTime&&(l=!0);
var d=Math.abs(1*s-1*this.progressBarSeekData.dragTime);
(l||d>=.5)&&(this.progressBarSeekData.dragTime=s,k("_pointerMoveHandler set currentTime, dragTime:"+this.progressBarSeekData.dragTime+" currentTime:"+this.video.currentTime),
this.video.currentTime=this.progressBarSeekData.dragTime,this.__setPlayTime(this.progressBarSeekData.dragTime)),
this.__setControllBar(a),e.e&&e.e.preventDefault();
},
_pointerUpHandler:function(e){
var t=this;
e.e.preventDefault(),this.container.find(".js_controll").off("mousemove",t._event.progressBarMousemove),
this.container.find(".js_video_poster").off("mousemove",t._event.progressBarMousemove),
$(document.body).off("mouseup",t._event.progressBarMouseup),this.container.find(".js_progress_bar").off("touchmove",t._event.progressBarTouchmove).off("touchend",t._event.progressBarTouchend),
"undefined"==typeof this.progressBarSeekData.dragTime&&this._pointerMoveHandler({
x:e.x,
y:e.y
});
var i=this.progressBarSeekData.dragTime,o=this.progressBarSeekData.startTime;
i==this.video.currentTime&&(i-=.1),this.progressBarSeekData.startTime&&t.__dragTimes.push(Math.round(1e3*this.progressBarSeekData.startTime)+":#:"+Math.round(1e3*i)),
this.progressBarSeekData=null,k("_pointerUpHandler dragTime:"+i+" currentTime:"+this.video.currentTime),
setTimeout(function(){
t.__onTouch=!1,t.__forcePause=!1,t.isEnd()||(t.showLoading(),t.play(i),t._seekReport(),
t._trigger("barDragComplete",{
playTime:i,
startDragVideoTime:o
}));
},0),this.__hideControllTimeout();
},
_seekReport:function(){
this.videoCtlReport({
step:13
});
},
_hidePlayControllBar:function(){
this.container.find(".js_video_pause_controll").hide(),this._g.isUserPause&&m.device.inWechat&&("wifi"===this._g.pauseNetType&&T.isVideoNeedFlowNotice(this.opt.flow,3)||T.isNoneNetwork(this._g.pauseNetType)&&T.isVideoNeedFlowNotice(this.opt.flow,4)?this.__showFlowNotice_1():(this._g.isUserPause=!1,
this._g.pauseNetType=null)),this.__hideControllTimeout();
},
_showPlayControllBar:function(){
var e=this.container.find(".js_video_pause_controll");
this.isEnd()||(this.opt.pauseShowControll?(e.hide(),this.showControllBar()):(this.hideControllBar({
showShareBtn:!!this.opt.canShareVideo
}),e.show(),this.container.find(".js_video_play_controll").hide()));
},
_addSerialTimeupdate:function(){
var e=this.video.currentTime,t=this._g.serialTimeupdateCache.length;
e>0&&(0==t||this._g.serialTimeupdateCache[t-1].currentTime!=e)&&(this._g.serialTimeupdateCache.length>=this._g.timeupdateCacheCount&&this._g.serialTimeupdateCache.shift(),
this._g.serialTimeupdateCache.push({
currentTime:e,
timeStamp:+new Date
}));
},
_checkPlayBySerialTimeupdate:function(){
if(this._g.serialTimeupdateCache.length<this._g.timeupdateCacheCount)return!1;
var e=this._g.serialTimeupdateCache.length,t=this._g.serialTimeupdateCache[e-1],i=this._g.serialTimeupdateCache[e-this._g.timeupdateCacheCount];
return t.timeStamp-i.timeStamp<2500?!0:!1;
},
_showPlayer:function(){
var e=this.container.find(".js_page_video");
e.show();
},
_hidePlayer:function(){
var e=this.container.find(".js_page_video");
e.hide();
},
__setPlayTime:function(e){
this.container.find(".js_now_play_time").text(I(e));
},
__setControllBar:function(e){
e=Math.ceil(100*e),0>e&&(e=0),e>100&&(e=100);
this.video,this.duration;
this.__setBufferBar(e),e+="%";
var t=this.container;
t.find(".js_played_bar").css({
width:e
}),t.find(".js_played_speed_cnt").css({
left:e
});
},
__setForwardBar:function(e){
var t=this.container,i=(this.video,this.__getDuration()),o=e/i;
t.find(".js_forward").removeClass("none"),t.find(".total_time").text(I(i)),t.find(".js_forward_bar").css("width",100*o+"%"),
t.find(".js_forward_play_time").text(I(e));
},
__setBufferBar:function(e){
var t=this.container,i=this.video,o=this.__getDuration(),n=i.currentTime;
e=e||n/o;
var a=e;
i.buffered&&i.buffered.length>0&&i.buffered.end&&o&&(a=i.buffered.end(0)/o,a=Math.max(e,Math.ceil(parseInt(100*a))),
a>98&&(a=100)),t.find(".js_buffer_bar").css({
width:a+"%"
});
},
__resetVideo:function(){
this.$video.remove();
var e=this.container,t=e.find(".js_video_poster");
t.append("<video></video>");
{
var i=this.$video=t.find("video");
this.video=i[0];
}
this.__canplay=!1,this.__forcePause=!1,this.__initVideo(),this.__iosPreloadPause=!1,
this.__iosPreloadPlayFlag=!1,this.__bindVideoEvent();
},
_trigger:function(e,t){
var i=this,o=this;
if("timeupdate"!==e||"timeupdate"===e&&this._g.triggerTimeupdateLog){
"timeupdate"===e&&(this._g.triggerTimeupdateLog=!1,setTimeout(function(){
i._g.triggerTimeupdateLog=!0;
},5e3));
try{
var n="",a=Object.prototype.toString.call(t);
n="[object String]"===a?t:"[object Object]"===a||"[object Array]"===a?JSON.stringify(t):"no params",
this._jsapiLog("trigger:"+e+";arg:"+n+";");
}catch(s){}
}
if("readyBeginPlay"==e&&(o.__iosPreloadPlayFlag=!1),"play"==e&&0==o.__iosPreloadPlayFlag){
if(o.__iosIsRealPreload&&r(o.video,!1),o.__forcePause=!1,o.opt.notPauseOtherVideoWhenPlay||p.broadcastMessage({
type:"broadcastPlay",
data:{
id:this.id
}
}),window.parent.originalVideoAdFrames&&0!=window.parent.originalVideoAdFrames.length)for(var l=0;l<window.parent.originalVideoAdFrames.length;l++)window.parent.originalVideoAdFrames[l].contentWindow.postMessage({
action:"pauseAd",
value:""
},"*");
g.postMessage(window.parent,"onVideoPlayV2",{
vid:f.getQuery("vid")
});
}
var d=this.plugins,u=this._blockPlugin[e]||this._blockPlugin.all,_=0;
if(u&&"function"==typeof u.recv&&(_|=u.recv(e,t),1&_))return!1;
for(var l=0,h=d.length;h>l&&(_|=d[l].recv(e,t),!(2&_));++l);
if(!(this._blockInnerHandler||4&_)){
var c=this["__"+e+"Handler"];
c&&c.call(this,t);
}
8&_||this.__triggerOutside(e,t);
},
_setBlockInnerHandler:function(e){
this._blockInnerHandler=e;
},
_setBlockPlugin:function(e,t){
this._blockPlugin[e]=t;
},
_getContainer:function(){
return this.container;
},
_setCover:function(e,t){
this.container.find(".js_poster_cover").css(t),this.opt.cover=e,this._g.coverBase64="";
},
_removeCover:function(e){
var e=e||{
"background-image":"none"
};
this.container.find(".js_poster_cover").css(e);
},
_afterReplay:function(){
this.__hasBeginPlay=!0,this.__userplaytime=!0,this.__firstPlayStart=+new Date,this.showLoading(),
this.play(),this._trigger("afterReplay");
},
setSrc:function(e,t,i){
var o=this,n=this.$video,a=(this.opt,this.video);
this.src=e,(!o.__iosPreloadPause||i)&&o.__initData(),o.__initVideo(),this.showCover(),
o.log.loadwait_start=+new Date,(!n.attr("src")||i)&&(n.attr("src",e),m.proxyPreloadExper()&&m.proxyPreloadExper().isUsePreload&&_.os.ios&&!o.opt.ad_muted_btn&&!function(){
var e=function t(){
o.__iosPreloadPause=!0;
var e=function i(){
o._g.iosPreloadTmpPlay=!1,a.removeEventListener("pause",i,!1);
};
a.addEventListener("pause",e,!1),a.pause(),o._trigger("ready",o.opt),a.removeEventListener("canplay",t,!1);
};
a.addEventListener("canplay",e,!1),4!==a.readyState&&(o._g.iosPreloadTmpPlay=!0,
o.__iosPreloadPlayFlag=!0,o.__iosIsRealPreload=!0,r(a,!0),a.play());
}()),a.preload=t||"metadata",n.on("loadedmetadata",function(){
if(o.__videoDurationchange(),o.__playQueue&&o.__playQueue.length>0){
var e=o.__playQueue[0].sec;
o.__playQueue=[],o.play(e);
}
}),a.duration>0&&1!=a.duration&&o.__videoDurationchange();
},
videoCtlReport:function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.opt.extinfo;
if(t){
var i={
step:e.step,
vid:t.vid,
hit_bizuin:t.hit_bizuin,
hit_vid:t.hit_vid,
traceid:t.pageplayer._getTraceId(),
orderid:t.pageplayer._getOrderid(),
ori_status:t.pageplayer._getOriStatus(),
type:this.opt.videoReportType,
fromid:t.pageplayer._getFromid()
};
e.step>=16?(i.remind_traffic_size=parseInt(1024*this.opt.flow),i.traffic_reminder_type=e.noticeType,
h.commReport(i)):h.report(i);
}
},
videoEnd:function(){
this.changeStatus({
status:"end",
subStatus:""
}),this.__endCountTime(),this._trigger("end");
},
replay:function(){
this.container.find(".js_video_play_controll").hide(),this._trigger("readyBeginPlay"),
this._trigger("replay");
},
resetVideo:function(){
this.opt.autoReplay||(this.opt.autoplay=!1),this.container.find(".js_video_poster").hide(),
this.showCover(),this.__resetVideo(),this._trigger("loading");
},
setSrcWithTime:function(e){
var t=this.video.currentTime;
this.resetVideo(),this.setSrc(e,!1,!0),this._jsapiLog("lastPlayTime:"+t),this.__continueSec=t;
},
changeStatus:function(e){
var t=this._g;
if(t.statusDefine[e.status]&&(!e.subStatus||t.subStatusDefine[e.subStatus]||"error"===e.status)&&(t.status!==e.status||t.subStatus!==e.subStatus)){
var i=0;
"end"===e.status||"error"===e.status?(this._playingBufferingStartTime=null,this.__userplaytime=!1):"pause"===e.status?this._playingBufferingStartTime=null:"play"===e.status&&"playing"===e.subStatus&&null!==this._playingBufferingStartTime?(i=+new Date-this._playingBufferingStartTime,
this._playingBufferingStartTime=null):!this.__hasBeginPlay||!this.__canplay||this.__userplaytime||"loading"!==e.status||"waiting"!==e.subStatus&&"seeking"!==e.subStatus||null!==this._playingBufferingStartTime||(this._playingBufferingStartTime=+new Date);
var o=t.status,n=t.subStatus;
t.status=e.status,t.subStatus=e.subStatus;
var a=["player statusChange, preStatus:",o,"; status:",t.status,"; preSubStatus:",n,"; subStatus:",t.subStatus,"; video_duration:",this.video?this.video.duration:"0","; getvinfo_duration:",this.opt.duration,"; current_time:",this.video?this.video.currentTime:"0","; play_total_time:",this.getPlayTotalTime()].join("");
this._jsapiLog(a),k(a),p.broadcastMessage({
type:"statusChange",
data:{
id:this.id,
preStatus:o,
preSubStatus:n,
status:t.status,
subStatus:t.subStatus
}
}),this._trigger("statusChange",{
currentTime:this.video.currentTime,
preStatus:o,
preSubStatus:n,
status:t.status,
subStatus:t.subStatus
}),i&&this._trigger("playingBufferingTime",{
bufferingTime:i
});
}
},
play:function(e){
var t=this.video,i=this;
if(!i.isEnd()){
if(!t||0==t.readyState)return void(this.__playQueue[0]={
sec:e
});
e*=1;
try{
if(isNaN(e)||"number"!=typeof e)i.__canplay&&i.isPause()||0==t.currentTime?t.play():t.currentTime=0;else{
var o=this.__getDuration();
e>=o&&(e=o-1),0>e&&(e=0),e=1*(1*e).toFixed(4),i.__last_playtime=e,i.__setPlayTime(e),
t.currentTime==e?t.play():t.currentTime=e;
}
}catch(n){
0==t.currentTime?t.play():t.currentTime=0;
}
}
},
pause:function(){
var e=this.video;
e&&0==e.readyState||(this.__replaySec=null,this.waitingHandlerTimer&&(clearTimeout(this.waitingHandlerTimer),
this.waitingHandlerTimer=null),e.pause(),k(this.id+":pause function"));
},
getCoverBase64:function(){
var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
this._g.coverBase64?"function"==typeof t.callback&&t.callback({
cover64:this._g.coverBase64||""
}):!function(){
var i=e,o=new Image;
o.crossOrigin="anonymous",o.onload=function(){
this.onload=null,this.onerror=null;
try{
var e=this.naturalWidth||this.width,o=this.naturalHeight||this.height,n=document.createElement("canvas"),a=n.getContext("2d");
n.style.width=e+"px",n.width=e,n.style.height=o+"px",n.height=o,a.drawImage(this,0,0,e,o),
i._g.coverBase64=n.toDataURL("image/jpeg",1);
}catch(r){
this._jsapiLog("jsapi shareEmbedMpVideo error:"+r),i._g.coverBase64="";
}
"function"==typeof t.callback&&t.callback({
cover64:i._g.coverBase64
});
},o.onerror=function(){
this.onload=null,this.onerror=null,"function"==typeof t.callback&&t.callback({
cover64:""
});
},o.src=e.opt.cover;
}();
},
callJsapiShareVideo:function(){
var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
if(this.opt.extinfo&&this.opt.extinfo.preview)return void p.postMessage({
type:"showTips",
data:{
msg:"预览图文中的视频不可分享"
}
});
if(!this._g.loadingCoverBase64){
var i=function(){
var i="",o="",n="";
try{
i=parent.window.msg_link.html(!1),o=parent.window.user_name||(window.cgiData?window.cgiData.username||window.cgiData.user_name:"")||"",
n=parent.window.nickname||(window.cgiData?window.cgiData.nick_name:"")||"";
}catch(a){
e._jsapiLog(t.action+" jsapi error:"+a);
}
var r=e.opt.extinfo,s="";
r&&(s=r.vid);
var l={
action:t.action,
mpUrl:i,
bizUsrName:o,
bizNickName:n,
videoVid:s,
videoUrl:f.addParam(e._g.oriSrc||e.src||e.opt.src,"video_md5",e.opt.videoMd5||""),
videoThumbUrl:e.opt.cover,
videoThumbData:e._g.coverBase64,
videoTitle:e.opt.videoTitle,
videoDuration:1*e.opt.duration
};
y.invoke("handleMPPageAction",l,function(){});
};
this._g.loadingCoverBase64=!0,this.getCoverBase64({
callback:function(){
e._g.loadingCoverBase64=!1,i();
}
});
}
},
onFullScreenChange:function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.type,i=e.state,o=this.$video;
i?(o.parents(".js_inner").removeClass("not_fullscreen"),this.__isInFullScreen=!0):(o.parents(".js_inner").addClass("not_fullscreen"),
this.hideLoading(),this.__isInFullScreen=!1),this._trigger("fullscreenchange",{
state:i,
type:t
}),p.broadcastMessage({
type:"fullscreenchange",
data:{
fullScreen:this.__isInFullScreen,
type:t,
id:this.id
}
});
},
enterFullScreen:function(){
var e=this,t=function(){
e._g.jsapiFullScreenId&&(clearTimeout(e._g.jsapiFullScreenId),e._g.jsapiFullScreenId=null);
var t=e.video;
t.requestFullscreen?(t.requestFullscreen(),e.__isInFullScreen=!0):t.mozRequestFullScreen?(t.mozRequestFullScreen(),
e.__isInFullScreen=!0):t.webkitRequestFullscreen?(t.webkitRequestFullscreen(),e.__isInFullScreen=!0):t.webkitEnterFullscreen&&(t.webkitEnterFullscreen(),
e.__isInFullScreen=!0);
};
if(this._g.jsapiFullScreenId&&(clearTimeout(this._g.jsapiFullScreenId),this._g.jsapiFullScreenId=null),
!this.opt.jsapiFullScreen||this._g.jsapiFullScreenErrCnt>=this._g.jsapiFullScreenErrLimit)return void t();
_.os.android||this.pause4outer({
triggerEvent:!1
});
var i="",o="",n="",a="",r="",s=this;
try{
if(r=parent.window.source||"",i=parent.window.msg_link.html(!1),o=parent.window.user_name||(window.cgiData?window.cgiData.username||window.cgiData.user_name:"")||"",
n=parent.window.nickname||(window.cgiData?window.cgiData.nick_name:"")||"",this.opt.videoCrossOrigin){
var l=document.createElement("canvas"),d=l.getContext("2d");
l.style.width=this.opt.videoWidth+"px",l.width=this.opt.videoWidth,l.style.height=this.opt.videoHeight+"px",
l.height=this.opt.videoHeight,d.drawImage(this.$video[0],0,0,this.opt.videoWidth,this.opt.videoHeight),
a=l.toDataURL("image/jpeg",1);
}
}catch(u){
this._jsapiLog("jsapi enterfullsrceen error:"+u);
}
var h=this.$video[0],c=null,p=null;
try{
for(p=h.getBoundingClientRect(),c={
left:p.left,
top:p.top,
height:p.bottom-p.top,
width:p.right-p.left
};h.ownerDocument.defaultView.parent!==window&&(h=h.ownerDocument.defaultView.frameElement);)p=h.getBoundingClientRect(),
c.left+=p.left,c.top+=p.top;
c.left=Math.round(c.left),c.top=Math.round(c.top),c.height=Math.round(c.height),
c.width=Math.round(c.width);
}catch(u){
this._jsapiLog("jsapi enterfullsrceen error:"+u),c={
left:0,
top:0,
height:0,
width:0
};
}
var g=this.opt.extinfo,m="";
g&&(m=g.vid);
var v={
action:"enterEmbedMpVideo",
mpBizUin:this.opt.__biz||"",
mpAppMsgId:this.opt.mid||"",
mpIndex:this.opt.idx||"",
mpUrl:i,
bizUsrName:o,
bizNickName:n,
videoUrl:f.addParam(this._g.oriSrc||this.src||this.opt.src,"video_md5",this.opt.videoMd5||""),
videoTitle:this.opt.videoTitle,
videoCurrTime:this.getCurTime(),
videoWidth:this.opt.videoWidth,
videoHeight:this.opt.videoHeight,
videoThumbUrl:this.opt.cover,
videoDuration:1*this.opt.duration,
videoVid:m,
playerX:c.left,
playerY:c.top,
playerWidth:c.width,
playerHeight:c.height,
subscene:1*r,
headImgUrl:this.opt.headImgUrl,
currFrameData:a,
forbidForward:this.opt.canShareVideo?0:1
};
this.__isInFullScreen=!0,a&&(this._g.jsapiFullScreenId=setTimeout(function(){
e.__isInFullScreen=!1;
},2e3)),y.invoke("handleMPPageAction",v,function(e){
s._g.jsapiFullScreenId&&(clearTimeout(s._g.jsapiFullScreenId),s._g.jsapiFullScreenId=null),
/:ok$/.test(e.err_msg)?(s.__isInFullScreen=!0,s.onFullScreenChange({
state:!0,
type:"jsapi"
})):(s.__isInFullScreen=!1,_.os.android||s.play4outer(0/0,{
triggerEvent:!1
}),s._g.jsapiFullScreenErrCnt++);
}),_.os.android&&(parent.window.CustomFullscreenApi&&"function"==typeof parent.window.CustomFullscreenApi._customEnterFullscreen&&parent.window.CustomFullscreenApi._customEnterFullscreen(!0),
t());
},
exitFullScreen:function(){
this.video;
this.hideLoading(),document.webkitExitFullscreen&&document.webkitExitFullscreen(),
this.__isInFullScreen=!1;
},
isInFullScreen:function(){
return!!this.__isInFullScreen;
},
play4outer:function(e){
var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];
this.__forcePause=!1,this.play(e),t.triggerEvent!==!1&&this._trigger("userplay"),
this._hidePlayControllBar();
},
pause4outer:function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
this.hideLoading(),this.pause(),e.triggerEvent!==!1&&this._trigger("userpause"),
this.hideControllBar(),this._showPlayControllBar();
},
setWidth:function(e){
this.container.find(".js_page_video").css({
width:e
});
},
setHeight:function(e){
this.container.find(".js_page_video").css({
height:e
});
},
showCover:function(){
this.container.find(".js_poster_cover").show();
},
hideCover:function(){
this.container.find(".js_poster_cover").hide();
},
showFuncControllBar:function(){
var e=this.container.find(".js_progress_bar,.js_full_screen_control");
e.show(),this.__hasFuncControllBar=!0;
},
hideFuncControllBar:function(){
var e=this.container.find(".js_progress_bar,.js_full_screen_control");
e.hide(),this.__hasFuncControllBar=!1;
},
showControllBar:function(){
this.__touchVideoTimeoutHandler&&clearTimeout(this.__touchVideoTimeoutHandler),this.__timerHideControll&&(clearTimeout(this.__timerHideControll),
this.__timerHideControll=null),this.__userplaytime||this.container.find(".js_controll").removeClass("opr_fade_out").show(),
this.opt.canShareVideo&&(this.__userplaytime?this.container.find(".js_page_video").addClass("wx_video_status_initial"):this.container.find(".js_page_video").removeClass("wx_video_status_initial"),
this.container.find(".js_share_btn_contain").removeClass("opr_fade_out").show());
},
hideControllBar:function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.container.find(".js_controll"),i=this.container.find(".js_share_btn_contain");
t.removeClass("opr_fade_in");
var o=this;
o.__timerHideControll&&clearTimeout(o.__timerHideControll),t.addClass("opr_fade_out"),
e.showShareBtn!==!0?i.removeClass("opr_fade_in").addClass("opr_fade_out"):i.removeClass("opr_fade_out").show(),
o.__timerHideControll=setTimeout(function(){
t.hide(),e.showShareBtn!==!0&&i.hide();
},500);
},
showLoading:function(e){
var t=this;
this.__always_hide_loading||this.__isshowLoading&&this.video&&this.video.currentTime>1||(this.__isshowLoading=!0,
this._g.resetShowingLoadingTimeoutId&&(clearTimeout(this._g.resetShowingLoadingTimeoutId),
this._g.resetShowingLoadingTimeoutId=null),this._g.resetShowingLoadingTimeoutId=window.setTimeout(function(){
t.__isshowLoading=!1;
},1e3),this._g.showingLoadingTimeoutId&&(clearTimeout(this._g.showingLoadingTimeoutId),
this._g.showingLoadingTimeoutId=null),"firstTime"==e?this.container.find(".js_loading").addClass("start_loading").show():this._g.showingLoadingTimeoutId=setTimeout(function(){
t.container.find(".js_loading").show();
},800));
},
hideLoading:function(){
this.container.find(".js_loading").removeClass("start_loading").hide(),this._g.showingLoadingTimeoutId&&(clearTimeout(this._g.showingLoadingTimeoutId),
this._g.showingLoadingTimeoutId=null);
},
triggerMuted:function(e){
e?(r(this.video,!0),this.container.find(".js_muted_btn").addClass("muting")):(r(this.video,!1),
this.container.find(".js_muted_btn").removeClass("muting"));
},
setVideoCSS:function(e){
var t=this,i=t.container,o=i.find(".js_page_video");
o.css(e);
},
afterFirstLoaded:function(){
this.__userplaytime&&(this.__userplaytime=!1,this.reportRealLoadingTime(),this._trigger("touchVideo",{
isShow:!0
}));
},
reportRealLoadingTime:function(){
var e=this;
e.__firstPlayEnd=+new Date;
var t=parseInt(e.__firstPlayEnd-e.__firstPlayStart);
if(console.info("[视频点击播放耗时]",t),e._trigger("firstBufferingTime",{
bufferingTime:t
}),m.proxyPreloadExper()){
var i=w.toBase64(JSON.stringify({
scene:window.source,
sessionid:window.sessionid
}));
1==m.proxyPreloadExper().experSet?v.saveSpeeds({
sample:1,
uin:window.encodeURIComponent(w.toBase64(window.user_uin))||uin,
pid:1045,
speeds:{
sid:21,
time:t
},
user_define:i
}):2==m.proxyPreloadExper().experSet?v.saveSpeeds({
sample:1,
uin:window.encodeURIComponent(w.toBase64(window.user_uin))||uin,
pid:1045,
speeds:{
sid:22,
time:t
},
user_define:i
}):3==m.proxyPreloadExper().experSet?v.saveSpeeds({
sample:1,
uin:window.encodeURIComponent(w.toBase64(window.user_uin))||uin,
pid:1045,
speeds:{
sid:23,
time:t
},
user_define:i
}):4==m.proxyPreloadExper().experSet&&v.saveSpeeds({
sample:1,
uin:window.encodeURIComponent(w.toBase64(window.user_uin))||uin,
pid:1045,
speeds:{
sid:24,
time:t
},
user_define:i
}),v.send();
}
},
hasFullScreen:function(){
return this.isInFullScreen();
},
hasDrag:function(){
return!!this.__has_drag;
},
getCurTime:function(){
return this.video.currentTime;
},
getEndDom:function(){
return this.container.find(".js_end_dom");
},
getDrag:function(){
return this.__dragTimes;
},
getPlayTotalTime:function(){
return this.__endCountTime(),this.__play_total_time;
},
getLog:function(){
var e=this.log||{};
return{
hasended:e.hasended,
last_ms:Math.floor(1e3*(e.lastsec||0)),
duration_ms:Math.floor(1e3*(e.duration||0)),
video_error:e.video_error||0,
video_error_code:e.video_error_code||0,
loadwait:e.loadwait||0
};
},
isPlay:function(){
return!this.video.paused&&!this.isEnd();
},
isPause:function(){
return!!this.video.paused;
},
isEnd:function(){
return!!this.video.ended;
},
hasBeginPlay:function(){
return this.__hasBeginPlay;
},
destroy:function(){
p.removeListener({
type:"broadcastPlay",
func:this._event.broadcastPlay
});
try{
delete parent.window.__MpPlayers[this.id];
}catch(e){}
C.visibilityPausePlayer===this&&(C.visibilityPausePlayer=null);
},
_setBeginPlayStatus:function(){
var e=this;
this.hideLoading(),this.container.find(".js_video_play_controll").css({
display:"block"
});
var t=this.opt.duration;
t&&t>0&&this.container.find(".js_video_length").html(I(t)).show(),1==this.__iosPreloadPause&&!function(){
var t=e;
setTimeout(function(){
var e=t.container.find(".js_video_pause_controll");
e.hide();
var i=t.container.find(".js_video_play_controll");
i.show();
});
}();
},
hidePlayBtn:function(){
this.container.find(".js_video_play_controll").hide();
}
}),V._getFormatTime=I,V;
});function _typeof(e){
return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e;
}
define("new_video/plugin/ad.js",["biz_wap/zepto/zepto.js","biz_wap/zepto/event.js","biz_wap/zepto/touch.js","biz_wap/utils/device.js","biz_wap/utils/ajax.js","biz_wap/utils/storage.js","biz_wap/utils/hashrouter.js","biz_wap/jsapi/core.js","biz_wap/utils/jsmonitor_report.js","new_video/plugin_base.js","new_video/plugin/imgAd.js","new_video/plugin/frameAd.js","new_video/ctl.js","new_video/player.js","a/wxopen_card.js","biz_common/utils/report.js","biz_wap/utils/openUrl.js","a/a_utils.js","a/a_config.js","biz_common/utils/url/parse.js","biz_wap/utils/mmversion.js","common/utils.js"],function(require,exports,module,alert){
"use strict";
function log(e){
"undefined"!=typeof JSAPI&&JSAPI.log&&JSAPI.log(e);
}
function report(e,t){
Report("http://mp.weixin.qq.com/mp/ad_report?action=follow&type="+e+t);
}
function adOptReport(e,t,a,i){
t=6,Report("http://mp.weixin.qq.com/mp/ad_complaint?&action=report&type="+e+"&pos_type="+t+"&trace_id="+a+"&aid="+i+"&__biz="+parent.window.biz+"&r="+Math.random());
}
function setPageTitle(e){
JSAPI.invoke("setPageTitle",{
title:e||""
}),parent.window.document.title=e;
}
function videoAdReport(e){
ajax({
url:"/mp/ad_video_report?action="+(e.action||"exposure"),
type:"post",
data:{
step:e.step||"",
view_id:e.view_id||"",
traceid:e.traceid||"",
orderid:e.orderid||0,
ad_source:e.ad_source||0,
report_time:e.report_time,
devicetype:parent.window.devicetype,
version:parent.window.clientversion,
__biz:parent.window.biz||"",
lcount:1,
type:e.type
}
});
}
function report3rd(e,t){
e=1e3*e|0,t.forEach(function(t){
1!=t.reported&&e>=t.report_time&&(t.reported=1,iframe&&iframe.contentWindow&&iframe.contentWindow.postMessage(JSON.stringify({
type:"report",
url:t.url
}),location.protocol+"//"+location.host));
});
}
function parseCookie(e){
var t,a;
try{
t=e.split("Expires="),a=t[1]&&t[1].replace(";",""),a=Date.parse(a);
}catch(i){
a=null;
}
return a;
}
require("biz_wap/zepto/zepto.js"),require("biz_wap/zepto/event.js"),require("biz_wap/zepto/touch.js");
var Device=require("biz_wap/utils/device.js"),ajax=require("biz_wap/utils/ajax.js"),LS=require("biz_wap/utils/storage.js"),HashRouter=require("biz_wap/utils/hashrouter.js"),JSAPI=require("biz_wap/jsapi/core.js"),jsmonitorReport=require("biz_wap/utils/jsmonitor_report.js"),Plugin=require("new_video/plugin_base.js"),ImgAd=require("new_video/plugin/imgAd.js"),FrameAd=require("new_video/plugin/frameAd.js"),VideoCtl=require("new_video/ctl.js"),Player=require("new_video/player.js"),Wxopen_card=require("a/wxopen_card.js"),Report=require("biz_common/utils/report.js"),openUrl=require("biz_wap/utils/openUrl.js"),utils=require("a/a_utils.js"),AD_CONFIG=require("a/a_config.js"),urlParser=require("biz_common/utils/url/parse.js"),mmversion=require("biz_wap/utils/mmversion.js"),commonUtils=require("common/utils.js"),OpenUrlWithExtraWebview=openUrl.openUrlWithExtraWebview,openWebAppStore=utils.openWebAppStore,CAN_CLOSE_TIME=5,AD_TYPE_VIDEO15S=1515,AD_TYPE_VIDEO6S=888,AD_TYPE_IMG5S=555,is_yyb_installed=!1,yyb_pkgname="com.tencent.android.qqdownloader",yyb_min_version=1060125;
JSAPI.invoke("getInstallState",{
packageName:yyb_pkgname
},function(e){
var t=e.err_msg;
log("getInstallState @yingyongbao : "+t);
var a=t.lastIndexOf("_")+1,i=t.substring(a);
1*i>=yyb_min_version&&t.indexOf("get_install_state:yes")>-1&&(is_yyb_installed=!0);
});
var fnOpenApp=function(e){
JSAPI.invoke("launchApplication",{
schemeUrl:e
});
},appmsgTitle=parent.window.document.title,testJson={
base_resp:{
ret:0
},
ticket:"asd",
video_ad_item_list:[{
url:"http://www.qq.com/",
report_time:0,
no_click:0,
jump_url:"http://wximg.qq.com/tmt/_events/20150831-gongyi/dist/html/",
local_storage:"",
report_3rd:[],
duration:15e3,
aid:"testviewid",
view_id:"testviewid",
orderid:"testorderid",
traceid:"testtraceid",
pt:100,
app_info:{
auto_download:1,
app_id:1206479,
app_name:"天朝小将",
version_code:390,
apk_name:"com.joygame.loong",
app_md5:"5E82FC113CECB2773598646D7301587D",
appinfo_url:"http://imc.l.qq.com/ss",
signature_md5:"5F1C5D905813BD1F382A4E72B978F2F7",
channel_id:"xxx"
},
ad_source:1,
creative_type:AD_TYPE_VIDEO15S,
img_url:"http://shp.qpic.cn/qqvideo/0/q1320k59fh8/400",
close_time:0
}]
},r=Math.random();
testJson.video_ad_item_list[0].creative_type=AD_TYPE_VIDEO15S,testJson.video_ad_item_list[0].duration=15e3,
testJson.video_ad_item_list[0].close_time=5e3;
var doc=parent.window.document,iframe=doc.getElementById("js_video_ad_iframe");
iframe||(iframe=doc.createElement("iframe"),iframe.src="/mp/readtemplate?t=pages/video_ad_iframe",
iframe.id="js_video_ad_iframe",iframe.className="video_ad_iframe");
var iframeWrap=doc.getElementById("js_video_ad_iframe_wrap");
iframeWrap||(iframeWrap=doc.createElement("div"),iframeWrap.id="js_video_ad_iframe_wrap",
iframeWrap.className="video_ad_iframe",iframeWrap.style.overflow="scroll",iframeWrap.style.webkitOverflowScrolling="touch",
iframeWrap.style.display="none",iframeWrap.appendChild(iframe),doc.body.appendChild(iframeWrap));
var AdPlugin=function(e){
"undefined"==typeof e.videoReportType&&(e.videoReportType=-1),this.hasPlayAd=!1,
this.hasError=!1,this.vid=e.vid,this.oriVid=e.oriVid,this.opt=e,this.isMpVideo=e.isMpVideo,
console.log("init ad vid test: "+e.vid),this.initAd=!1;
var t=this;
this._ad_play_time=-1,this.__beforeplayHandler=[],t.__initAd();
};
return Plugin.inherit(AdPlugin,Plugin.Class),AdPlugin.prototype.__getAd=function(suc,err,complete){
var __commonVideoReport=parent.window.__commonVideoReport,that=this,opt=this.opt,tmpsn=","+["bbbe1aa6f92bad5000f34bb3cd8b5640","7d8e21a2fb0233d4cfc18d2e0ee0470b","5a2492d450d45369cd66e9af8ee97dbd","b5d3e9820a9e5c3fb442944c597efecf"].join(",")+",";
if(-1!=parent.location.href.indexOf("&_video_testad=1")&&opt.tmpGetAd&&tmpsn.indexOf(","+parent.sn+",")>=0){
var tmpSuc=function(e){
var t=e&&e.data&&e.data.totalUrl,a=e&&e.data&&e.data.time;
if(t&&a){
var i=testJson;
a=i.video_ad_item_list[0].duration/1e3,i.video_ad_item_list[0].url=t;
var o=that.adData=i.video_ad_item_list&&i.video_ad_item_list[0];
o.creative_type=o.creative_type||AD_TYPE_VIDEO15S,o.close_time="undefined"==typeof o.close_time?5e3:o.close_time,
that.__beforeplayHandler.push({
func:videoAdReport,
arg:[{
step:0==i.base_resp.ret?1:3,
view_id:o.view_id,
traceid:o.traceid,
orderid:o.orderid,
ad_source:o.ad_source,
report_time:0,
type:that.opt.videoReportType
}]
}),that.reportData=that.reportData2=[],suc({
video_ad_list:[{
image:[{
url:t
}],
duration:1e3*a
}]
});
}else err();
complete();
};
return opt.tmpGetAd(tmpSuc,function(){
err(),complete();
}),!1;
}
if(parent&&parent.window&&1==parent.window.no_vedio_ad)return err(),complete(),!1;
var cgiData=window.cgiData||{};
ajax({
url:"/mp/ad_video",
type:"post",
data:{
vid:that.vid,
clienttime:+new Date,
is_gray:VideoCtl.showAd()?1:0,
webviewid:VideoCtl.getWebviewid(),
__biz:parent.window.biz||"",
appmsgid:cgiData.mid,
idx:cgiData.idx,
type:that.opt.videoReportType
},
success:function success(resp){
__commonVideoReport&&__commonVideoReport(60);
try{
resp=eval("("+resp+")");
}catch(e){
resp={};
}
if(that.adVideoRet=resp.base_resp&&resp.base_resp.ret,that.ticket=resp.ticket||"",
!resp.base_resp||0!=resp.base_resp.ret&&1!=resp.base_resp.ret)return void err();
var adData=that.adData=resp.video_ad_item_list&&resp.video_ad_item_list[0];
return adData?(that.__beforeplayHandler.push({
func:videoAdReport,
arg:[{
step:0==resp.base_resp.ret?1:3,
view_id:adData.view_id,
traceid:adData.traceid,
orderid:adData.orderid,
ad_source:adData.ad_source,
report_time:0,
type:that.opt.videoReportType
}]
}),adData.creative_type=adData.creative_type||AD_TYPE_VIDEO15S,adData.close_time="undefined"==typeof adData.close_time?5e3:adData.close_time,
adData.creative_type!=AD_TYPE_VIDEO15S&&adData.creative_type!=AD_TYPE_VIDEO6S||adData.url?(that.reportData=[{
step:3,
time:adData.report_time||0,
traceid:adData.traceid,
orderid:adData.orderid,
ad_source:adData.ad_source,
view_id:adData.view_id
}],that.reportData2=[{
step:3,
time:0
},{
step:4,
time:5
}],void suc({
video_ad_list:[{
image:[{
url:adData.url
}],
duration:adData.duration
}]
})):void err()):void err();
},
error:function(e){
err();
var t=["uin:"+parent.window.user_uin,"status:"+e&&e.status].join("|");
(new Image).src="/mp/jsreport?key=69&content="+t+"&r="+Math.random();
},
complete:complete
});
},AdPlugin.prototype.__openWebview=function(e,t){
var a=this.adPlayer,i=this;
i.adData.jump_url=e,JSAPI.invoke("openUrlWithExtraWebview",{
url:e,
openType:1
},function(e){
e.err_msg.match(/\:ok$/)?(a.pause(),JSAPI.on("activity:state_change",function(e){
"onresume"==e.state.toLowerCase()&&a.play();
})):parent.window.location.hash="complain"==t?"adcomplain"+i.vid:"addetail"+i.vid;
});
},AdPlugin.prototype.__init6sVideoBtn=function(){},AdPlugin.prototype.__initIosAppBtn=function(){
var e=this,t=(this.player,this.adData),a=this.adPlayer,i=a._getContainer(),o=i.find(".js_ad_app"),r=i.find(".js_btn_ad_app"),d=t.jump_url;
(-1!=d.indexOf("https://itunes.apple.com/")||-1!=d.indexOf("http://itunes.apple.com/"))&&(o.show(),
r.on("touchend",function(){
e.__clickreport(),a.pause(),setTimeout(function(){
JSAPI.invoke("downloadAppInternal",{
appUrl:d
},function(t){
t.err_msg&&-1!=t.err_msg.indexOf("ok")||e.__openWebview(d);
});
},500);
}));
},AdPlugin.prototype.__initAndroidAppBtn=function(){
var e=this,t=(this.player,this.adData),a=t.app_info,i=this.adPlayer,o=i._getContainer(),r=o.find(".js_ad_app"),d=o.find(".js_btn_ad_app"),n=!1,p="",s=a.auto_download||0;
1==s&&d.addClass("primary").text("立即下载"),JSAPI.invoke("getInstallState",{
packageName:a.apk_name
},function(e){
var t=e.err_msg;
log("getInstallState @"+a.apk_name+" : "+t);
var i=t.lastIndexOf("_")+1,o=t.substring(i);
1*o>=a.version_code&&t.indexOf("get_install_state:yes")>-1?(n=!0,d.text("已安装app"),
d.removeClass("btn_download"),d.addClass("btn_installed")):r.show();
}),d.on("touchend",function(){
if(is_yyb_installed&&!n){
e.__clickreport();
var i="";
a.channel_id&&(i="&channelid="+a.channel_id);
var o=["&via=ANDROIDWX.YYB.WX.ADVERTISE",t.traceid,t.aid,a.apk_name,0,15,1].join(".");
setTimeout(function(){
fnOpenApp("tmast://download?oplist=1;2&pname="+a.apk_name+i+o);
},500);
}else{
if(n)return!1;
e.__clickreport(),setTimeout(function(){
var i="http://mp.weixin.qq.com/mp/ad_app_info?t=ad/videoad_app_detail&action=new&app_id="+a.app_id+p+"&md5sum="+a.app_md5+"&auto="+s+["&__biz=",parent.window.biz,"&uin=",uin,"&key=",key,"&pass_ticket=",pass_ticket,"&ticket=",e.ticket].join("");
1!=t.ad_source||!t.jump_url||0!=t.jump_url.indexOf("http://mp.weixin.qq.com/tp/ad_detail_info")&&0!=t.jump_url.indexOf("https://mp.weixin.qq.com/tp/ad_detail_info")||(i=t.jump_url,
-1!=i.indexOf("#wechat_redirect")?i=i.replace("#wechat_redirect","&ticket="+e.ticket+"#wechat_redirect"):i+="&ticket="+e.ticket),
e.__openWebview(i);
},500);
}
});
},AdPlugin.prototype.__initDetailBtn=function(){
var e=this,t=this.player,a=this.adPlayer,i=a._getContainer(),o=i.find(".js_ad_detail"),r=i.find(".js_btn_ad_detail"),d=i.find(".js_ad_opt_list_btn"),n=i.find(".js_complain_btn"),p=i.find(".js_ad_opt_list");
100==e.adData.pt?(r.text("了解公众号"),e.adData.jump_url=e.adData.jump_url.replace("#","&jsapi_scene=107&AdType=64#")):6==e.adData.dest_type?(r.html(46==e.adData.product_type?'<span class="icon26_weapp_white js_video_post_weapp_icon"></span> 进入小游戏':'<span class="icon26_weapp_white js_video_post_weapp_icon"></span> 了解详情'),
$(".js_btn_ad_detail").removeClass("with_arrow").addClass("with_weapp"),Wxopen_card.startConnect(e.adData)):(12==e.adData.product_type||19==e.adData.product_type)&&r.text("下载应用"),
o.show(),r.on("touchend",function(){
var a=e.adData.jump_url;
return 9==e.adData.dest_type?(JSAPI.invoke("openADCanvas",{
canvasId:e.adData.canvas_info.canvas_id,
preLoad:0,
noStore:0,
extraData:JSON.stringify({
pos_type:e.adData.pos_type
}),
adInfoXml:e.adData.canvas_info.ad_info_xml
},function(e){
0!=e.ret?(OpenUrlWithExtraWebview(t.opt.url),report(135,t.opt)):report(134,t.opt);
}),e.__clickreport(),!1):void(a&&6!=e.adData.dest_type?((0==a.indexOf("http://mp.weixin.qq.com")||0==a.indexOf("https://mp.weixin.qq.com"))&&(-1==a.indexOf("?")?a+="?ticket="+e.ticket:-1==a.indexOf("#")?a+="&ticket="+e.ticket:a=a.replace("#","&ticket="+e.ticket+"#")),
e.__openWebview(a),e.__clickreport()):6==e.adData.dest_type&&(e.adData.url=e.adData.jump_url,
Wxopen_card.openWxopen(e.adData),e.__clickreport()));
}),d.on("touchend",function(){
return window.can_see_complaint||(p.toggle(),adOptReport(0,e.adData.pos_type,e.adData.traceid,e.adData.aid)),
!1;
}),n.on("touchend",function(){
var t="https://mp.weixin.qq.com/promotion/res/htmledition/mobile/html/feedback.html?aid="+e.adData.aid+"&traceid="+e.adData.traceid+"&source=6&biz="+parent.window.biz;
return adOptReport(1,e.adData.pos_type,e.adData.traceid,e.adData.aid),e.__openWebview(t),
!1;
});
},AdPlugin.prototype.__clickreport=function(){
{
var e=this;
this.player;
}
videoAdReport({
action:"click",
view_id:e.adData.view_id,
traceid:e.adData.traceid,
orderid:e.adData.orderid,
ad_source:e.adData.ad_source,
report_time:e.getAdPlaytime(),
type:e.opt.videoReportType
}),VideoCtl.report({
vid:e.vid,
step:8,
ext1:e.getAdPlaytime(),
ext2:e.adData.jump_url,
ad_source:e.adData.ad_source,
orderid:e.getOrderid(),
traceid:e.getTraceId(),
type:e.opt.videoReportType,
fromid:e.opt.fromid
}),e.adData.report_3rd_click_url&&e.adData.report_3rd_click_url.forEach(function(e){
iframe&&iframe.contentWindow&&iframe.contentWindow.postMessage(JSON.stringify({
type:"report",
url:e
}),location.protocol+"//"+location.host);
});
},AdPlugin.prototype.__initAdEx=function(){
var e=this,t=this.adData,a=t.pt,i=(this.player,this.adPlayer,t.creative_type);
if(1!=t.no_click&&(i==AD_TYPE_VIDEO15S||i==AD_TYPE_VIDEO6S||i==AD_TYPE_IMG5S)){
if(9==e.adData.dest_type||6==e.adData.dest_type)return void e.__initDetailBtn();
if(103==a)return void e.__initIosAppBtn();
if(104==a)return void e.__initAndroidAppBtn();
if(t.jump_url)return void e.__initDetailBtn();
}
},AdPlugin.prototype.hasAd=function(e){
if(!e||!e.advertisement_info||!e.advertisement_info.length)return!1;
for(var t=0;t<e.advertisement_info.length;t++){
var a=e.advertisement_info[t];
a.pos_type===AD_CONFIG.AD_POS.POS_AD_BEFORE_VIDEO&&1===a.is_mp_video&&a.vid===this.oriVid&&commonUtils.report120081(8);
}
for(var i=0;i<e.advertisement_info.length;i++){
var a=e.advertisement_info[i];
if(a.pos_type===AD_CONFIG.AD_POS.POS_AD_BEFORE_VIDEO&&0===a.is_mp_video&&a.vid===this.oriVid)return!0;
}
return!1;
},AdPlugin.prototype.newHasAd=function(){
try{
for(var e=window.parent.document.getElementsByTagName("iframe"),t=0;t<e.length;t++)(window===e[t].contentWindow&&e[t].adVidFromAppmsg||e[t].adVidFromAppmsg===window.realVid)&&utils.report115849(67);
}catch(a){}
},AdPlugin.prototype.newInitAd=function(){
var e=this,t=void 0;
utils.listenMessage(window,function(a,i){
if(i.action===AD_CONFIG.AD_VIDEO_END_ACTION)return e.hasPlayAd=!0,void e.player._trigger("beginPlay");
if(i.action===AD_CONFIG.APPMSGAD_READY_ACTION){
if(utils.report115849(37),e.initAd=!0,window.adVidFromAppmsg&&utils.report115849(66),
e.newHasAd(),!e.hasAd(i.value))return;
utils.report115849(36),e.hasError=!1;
}else!e.initAd&&utils.postMessage(window.parent,AD_CONFIG.GET_APPMSGAD_READY_STATUS_ACTION,"");
i.action!==AD_CONFIG.SEND_AD_VID_ACTION||t?!t&&utils.postMessage(window.parent,AD_CONFIG.GET_AD_VID_ACTION,""):(i.value.adVidFromAppmsg&&!window.adVidFromAppmsg&&(window.adVidFromAppmsg=i.value.adVidFromAppmsg),
i.value.adVidFromAppmsg&&utils.report115849(57),t=!0);
}),utils.postMessage(window.parent,AD_CONFIG.GET_APPMSGAD_READY_STATUS_ACTION,""),
utils.postMessage(window.parent,AD_CONFIG.GET_AD_VID_ACTION,""),e.readyBeginPlayHandler=function(){
return utils.report115849(23),this.hasPlayAd||this.hasError||!window.adVidFromAppmsg?Plugin.BASE_BITSET:(utils.postMessage(window.parent,"onVideoPlayV2",{
vid:window.adVidFromAppmsg,
playAd:!0
}),this.player._trigger("preload"),8);
},e.beginPlayHandler=function(){
return this.hasPlayAd||this.hasError||!window.adVidFromAppmsg?Plugin.BASE_BITSET:14;
},e.loadingHandler=function(){
if(this.hasSetAdSrc||this.hadPlayAd||this.hasError)return Plugin.BASE_BITSET;
var e=this,t=e.player;
return e._whenGetAdSrc(function(){
utils.report115849(65),!this.initAd||this.hasError||this.hasSetAdSrc||(this.hasSetAdSrc=!0,
this.setUnblockEvt("loading")),window.adVidFromAppmsg||(this.hasPlayAd=!0),t.hideLoading(),
t._trigger("loading"),window.adVidFromAppmsg&&utils.report115849(50);
}),1;
};
},AdPlugin.prototype.__initAd=function(){
var e=this;
return utils.listenMessage(window,function(t,a){
a.action===AD_CONFIG.AD_VIDEO_PLAY_ACTION&&e.player.pause();
}),this.isMpVideo?(e.newInitAd(),void utils.report115849(74)):(utils.report115849(24),
void e.newInitAd());
},AdPlugin.prototype.__initOriginalVideoAd=function(){
var e=this;
window.parent.postMessage({
action:"originalVideoAdNeedData",
vid:e.vid
},"*"),window.addEventListener("message",function(t){
t.data&&"receiveOriginalVideoData"==t.data.action&&t.data.vid==e.vid&&(e.initAd=!0,
e.hasError=!1,e.adData=t.data.adData,e.adData&&e.adData.vid?commonUtils.report120081(1):e.hasError=!0,
e.player&&e.player.hideLoading());
});
},AdPlugin.prototype.getAdPlaytime=function(){
return this._ad_play_time;
},AdPlugin.prototype.getTraceId=function(){
return this.adData&&this.adData.traceid?this.adData.traceid:0;
},AdPlugin.prototype.getOrderid=function(){
return this.adData&&this.adData.orderid?this.adData.orderid:0;
},AdPlugin.prototype.init=function(){
this.container=$(this.player.opt.container),0==this.hasError&&(this.player.showLoading(),
this.setBlockEvt("loading"));
},AdPlugin.prototype.noop=function(){
return this.hasPlayAd||this.hasError?Plugin.BASE_BITSET:10;
},AdPlugin.prototype.loadingHandler=function(){
if(this.hasSetAdSrc||this.hadPlayAd||this.hasError)return Plugin.BASE_BITSET;
var e=this,t=e.player;
return e._whenGetAdSrc(function(){
if(this.initAd&&!this.hasError&&!this.hasSetAdSrc){
var a=e.video_url,i=t.opt,o=e.adData,r=o.creative_type,d=e.container,n=window.cgiData||{};
if(o.vid&&7==o.pos_type)var p=e.adPlayer=new FrameAd({
duration:o.duration,
videoDuration:e.duration,
container:d,
imgUrl:o.img_url,
adData:o,
ratio:i.ratio,
width:i.width,
height:i.height,
JSAPI:JSAPI,
appmsgData:{
biz:parent.window.biz||"",
appmsgid:n.mid,
idx:n.idx,
vid:o.vid
},
onTimeupdate:function(t,a){
e.timeupdate(t,a);
},
onEnd:function(){
e.end();
},
onHandler:function(a){
function i(e){
var t=document.createElement("div");
t.innerHTML=e;
var a=t.innerText||t.textContent;
return t=null,a;
}
var o=e.adData.jump_url,r=e.adData;
if(console.log(e.adData.button_action),console.log(_typeof(e.adData.button_action)),
"string"==typeof e.adData.button_action&&(console.log(i(e.adData.button_action)),
e.adData.button_action=JSON.parse(i(e.adData.button_action))),e.adData.button_action&&e.adData.button_action.jump_url&&(o=e.adData.button_action.jump_url),
console.log(o),"openFeedback"==a.proxyData.methodName){
var d="https://mp.weixin.qq.com/promotion/res/htmledition/mobile/html/feedback.html?aid="+e.adData.aid+"&traceid="+e.adData.traceid+"&source=6&biz="+parent.window.biz;
return adOptReport(1,e.adData.pos_type,e.adData.traceid,e.adData.aid),e.__openWebview(d),
!1;
}
if(r.app_info&&r.app_info.url_scheme&&mmversion.gtVersion("6.5.6",!0)){
var n=1,p=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);
p&&p[1]&&parseInt(p[1].split("_")[0],10)>=12&&(n=0);
var s={
schemeUrl:r.app_info.url_scheme,
messageExt:r.app_info.url_scheme,
appID:r.app_info.open_platform_appid
};
return r.product_type===AD_TYPE.IOS_APP_PRODUCT_TYPE&&utils.extend(s,{
installSchemeUrl:r.app_info.appinfo_url,
installAction:n
}),void JSAPI.invoke("launchApplication",s,function(e){
(-1===e.err_msg.indexOf("ok")||"fail"===e.launchInstallResult)&&(utils.isItunesLink(r.app_info.appinfo_url)?openWebAppStore(r.app_info.appinfo_url,r.ticket):location.href=r.app_info.url_scheme);
});
}
if(9==e.adData.dest_type)return JSAPI.invoke("openADCanvas",{
canvasId:e.adData.canvas_info.canvas_id,
preLoad:0,
noStore:0,
extraData:JSON.stringify({
pos_type:e.adData.pos_type
}),
adInfoXml:e.adData.canvas_info.ad_info_xml
},function(e){
0!=e.ret?(OpenUrlWithExtraWebview(o),report(135,t.opt)):report(134,t.opt);
}),e.__clickreport(),!1;
if(19==e.adData.product_type)return openWebAppStore(e.adData.app_info.appinfo_url,e.adData.ticket),
!1;
if(12==e.adData.product_type){
var _=e.adData.app_info;
return JSAPI.invoke("getInstallState",{
packageName:_.apk_name
},function(t){
var a=t.err_msg,i=a.lastIndexOf("_")+1,r=a.substring(i),d=!1,n="";
if(1*r>=_.version_code&&a.indexOf("get_install_state:yes")>-1&&(d=!0),is_yyb_installed&&!d){
var p="";
_.channel_id&&(p="&channelid="+_.channel_id);
var s=["&via=ANDROIDWX.YYB.WX.ADVERTISE",e.adData.traceid,e.adData.aid,_.apk_name,0,15,1].join(".");
fnOpenApp("tmast://download?oplist=1;2&pname="+_.apk_name+p+s);
}else if(d)console.log("has install app and do nothing");else{
var l="http://mp.weixin.qq.com/mp/ad_app_info?t=ad/videoad_app_detail&action=new&app_id="+_.app_id+n+"&md5sum="+_.app_md5+"&auto="+_.auto_download+["&__biz=",parent.window.biz,"&uin=",uin,"&key=",key,"&pass_ticket=",pass_ticket,"&ticket=",e.adData.ticket].join("");
!o||0!=o.indexOf("http://mp.weixin.qq.com/tp/ad_detail_info")&&0!=o.indexOf("https://mp.weixin.qq.com/tp/ad_detail_info")||(l=o,
-1!=l.indexOf("#wechat_redirect")?l=l.replace("#wechat_redirect","&ticket="+e.adData.ticket+"#wechat_redirect"):l+="&ticket="+e.adData.ticket),
e.__openWebview(l);
}
}),!1;
}
if(console.log(o,e.adData.dest_type),o&&6!=e.adData.dest_type){
if(0==o.indexOf("http://mp.weixin.qq.com")||0==o.indexOf("https://mp.weixin.qq.com")){
var l="ticket="+e.adData.ticket+"&aid="+e.adData.aid;
-1==o.indexOf("?")?o+="?"+l:-1==o.indexOf("#")?o+="&"+l:o=o.replace("#","&"+l+"#");
}
e.__openWebview(o),e.__clickreport();
}else 6==e.adData.dest_type&&(console.log("post open weapp"),e.adData.url=o||e.adData.jump_url,
Wxopen_card.openWxopen(e.adData),e.__clickreport());
},
onError:function(){
e.hasError=!0;
}
});else if(r==AD_TYPE_IMG5S){
var s=d.find(".js_adImgCover");
s.html('<img src="'+o.img_url+'">').show();
var p=e.adPlayer=new ImgAd({
duration:o.duration,
container:d,
imgUrl:o.img_url,
ratio:i.ratio,
width:i.width,
height:i.height,
onTimeupdate:function(t,a){
e.timeupdate(t,a);
},
onEnd:function(){
e.end();
}
});
}else if(r==AD_TYPE_VIDEO15S||r==AD_TYPE_VIDEO6S){
var p=e.adPlayer=new Player({
defineCSS:!0,
container:d,
cover:"",
ratio:i.ratio,
width:i.width,
height:i.height,
duration:e.duration,
autoplay:!1,
autoHide:!0,
loop:!1,
blockTouchVideo:!0,
plugins:[],
src:a,
onTimeupdate:function(t,a){
e.timeupdate(t,a);
},
onCanplay:function(){
0==e.hasPlayAd&&0==e.hasError&&videoAdReport({
step:2,
view_id:e.adData.view_id,
traceid:e.adData.traceid,
orderid:e.adData.orderid,
ad_source:e.adData.ad_source,
report_time:0,
type:e.opt.videoReportType
});
},
onEnd:function(){
e.end();
},
onError:function(){
var t=e.adPlayer;
t.isPlay()?e.end():(e.hasError=!0,e._whenEnded());
}
});
p.setSrc(a,-1==parent.window.location.search.indexOf("&preload=0")?"auto":"metadata");
}
this.hasSetAdSrc=!0,this.setUnblockEvt("loading");
}
t._trigger("loading");
}),1;
},AdPlugin.prototype.readyBeginPlayHandler=function(){
var e=this.__beforeplayHandler;
if(e&&e.length>0)for(var t=null;t=e.shift();){
var a=t.func;
"function"==typeof a&&a.apply(this,t.arg||[]);
}
if(this.hasPlayAd||this.hasError)return Plugin.BASE_BITSET;
{
var i=this,o=this.player,r=this.adPlayer,d=r._getContainer(),n=d.find(".js_btn_close_ad"),p=d.find(".js_ad_controll"),s=(d.find(".js_btn_ad_detail"),
d.find(".js_video_poster")),_=i.adData;
_.creative_type;
}
r.hideControllBar&&r.hideControllBar(),r._trigger("beginPlay"),r._showPlayer&&r._showPlayer(),
o._hidePlayer(),p.show(),n.on("touchend",function(){
videoAdReport({
step:4,
view_id:i.adData.view_id,
traceid:i.adData.traceid,
orderid:i.adData.orderid,
ad_source:i.adData.ad_source,
report_time:i.getAdPlaytime(),
type:i.opt.videoReportType
}),VideoCtl.report({
vid:i.vid,
step:5,
ext1:i.getAdPlaytime(),
ext2:i.adVideoRet,
orderid:i.getOrderid(),
traceid:i.getTraceId(),
ad_source:i.adData.ad_source,
type:i.opt.videoReportType,
fromid:i.opt.fromid
}),i.__hasShowCanCloseAd&&i._whenEnded(!0);
}),s.on("touchend",function(){
videoAdReport({
step:6,
view_id:i.adData.view_id,
traceid:i.adData.traceid,
orderid:i.adData.orderid,
ad_source:i.adData.ad_source,
report_time:i.getAdPlaytime(),
type:i.opt.videoReportType
});
});
var l;
return HashRouter.get("addetail"+i.vid,function(){
i.adData.jump_url&&(iframe&&iframe.contentWindow&&iframe.contentWindow.postMessage(JSON.stringify({
type:"page",
src:i.adData.jump_url
}),location.protocol+"//"+location.host),iframeWrap.style.display="block",doc.getElementById("js_article").style.display="none",
doc.body.style.overflow=document.documentElement.style.overflow="hidden",setPageTitle("广告详情"),
r.pause(),JSAPI.call("hideOptionMenu"),l=parent.window.pageYOffset||doc.documentElement.scrollTop);
}),HashRouter.get("adcomplain"+i.vid,function(){
var e="https://mp.weixin.qq.com/promotion/res/htmledition/mobile/html/feedback.html";
i.adData.jump_url&&(iframe&&iframe.contentWindow&&iframe.contentWindow.postMessage(JSON.stringify({
type:"page",
src:e
}),location.protocol+"//"+location.host),iframeWrap.style.display="block",doc.getElementById("js_article").style.display="none",
doc.body.style.overflow=document.documentElement.style.overflow="hidden",setPageTitle("广告投诉"),
r.pause(),JSAPI.call("hideOptionMenu"),l=parent.window.pageYOffset||doc.documentElement.scrollTop);
}),HashRouter.get("default",function(e){
e=="addetail"+i.vid&&(iframeWrap.style.display="none",doc.getElementById("js_article").style.display="block",
doc.body.style.overflow=document.documentElement.style.overflow="auto",l&&parent.window.scrollTo(0,l),
setPageTitle(appmsgTitle),r.play(),JSAPI.call("showOptionMenu"));
}),o._trigger("preload"),8;
},AdPlugin.prototype.beginPlayHandler=function(){
if(this.hasPlayAd||this.hasError){
{
var e=this;
e.player;
}
return Plugin.BASE_BITSET;
}
return 14;
},AdPlugin.prototype.canplayHandler=function(){
return this._adEndedTime&&!this._canplayTime&&(this._canplayTime=+new Date,this._canplayTime-this._adEndedTime>0&&jsmonitorReport.setAvg(27822,35,this._canplayTime-this._adEndedTime)),
Plugin.BASE_BITSET;
},AdPlugin.prototype.timeupdateHandler=function(){
return(this.hasPlayAd||this.hasError)&&this.hasError&&1==this.adVideoRet&&this.adData.report_3rd&&report3rd(0,this.adData.report_3rd),
this._adEndedTime&&this.hasPlayAd&&!this._timeupdateTime&&(this._timeupdateTime=+new Date,
this._timeupdateTime-this._adEndedTime>0&&jsmonitorReport.setAvg(27822,37,this._timeupdateTime-this._adEndedTime)),
Plugin.BASE_BITSET;
},AdPlugin.prototype.timeupdate=function(e,t){
{
var a=t.currentTime,i=this,o=i.adData,r=o.creative_type,d=this.adPlayer,n=d._getContainer(),p=n.find(".js_btn_can_close_ad"),s=n.find(".js_can_close_time"),_=n.find(".js_btn_close_ad"),l=n.find(".js_play_time");
n.find(".js_can_close_ad"),n.find(".js_ad_detail"),n.find(".js_ad_app");
}
i.__isInitAdEx||(console.log("__initAdEx"),i.__initAdEx(),i.__isInitAdEx=!0),o.close_time>=0?a>=CAN_CLOSE_TIME?(i.__hasShowCanCloseAd||(i.__hasShowCanCloseAd=!0),
p.hide(),_.show()):(p.show(),_.hide(),s.text("("+Math.round(CAN_CLOSE_TIME-a)+"s)")):p.hide();
var c=this.duration;
i._ad_play_time=1e3*a|0,l.text("("+Math.max(1,Math.floor(c-a))+"s)"),(r==AD_TYPE_VIDEO15S||r==AD_TYPE_VIDEO6S)&&this.processWhenInAdTime(),
this.reportData.forEach(function(e){
1!=e.reported&&1e3*a>=e.time&&(e.reported=1,e.report_time=i.getAdPlaytime(),e.type=i.opt.videoReportType,
videoAdReport(e));
}),this.reportData2.forEach(function(e){
1!=e.reported&&1e3*a>=e.time&&(e.reported=1,VideoCtl.report({
vid:i.vid,
step:e.step,
ext2:i.adVideoRet,
ad_source:i.adData.ad_source,
orderid:i.getOrderid(),
traceid:i.getTraceId(),
type:i.opt.videoReportType,
fromid:i.opt.fromid
}));
}),report3rd(a,this.adData.report_3rd);
},AdPlugin.prototype.processWhenInAdTime=function(){
var e=this.adPlayer.video,t=e.currentTime;
e&&this.lastCurrentTime&&t!=this.lastCurrentTime&&Math.abs(t-this.lastCurrentTime)>3?e.currentTime=this.lastCurrentTime:this.lastCurrentTime=t;
},AdPlugin.prototype.touchVideoHandler=function(){
return this.hasPlayAd||this.hasError?Plugin.BASE_BITSET:14;
},AdPlugin.prototype.end=function(){
videoAdReport({
step:5,
view_id:this.adData.view_id,
traceid:this.adData.traceid,
orderid:this.adData.orderid,
ad_source:this.adData.ad_source,
report_time:this.getAdPlaytime(),
type:this.opt.videoReportType
}),this._whenEnded(!0);
},AdPlugin.prototype._whenEnded=function(e){
var t=this,a=t.player,i=t.adPlayer;
this.hasPlayAd=!0,e&&(t._adEndedTime=+new Date),i&&i._hidePlayer&&i._hidePlayer(),
a._showPlayer(),e&&a._trigger("beginPlay");
},AdPlugin.prototype._whenGetAdSrc=function(e){
var t=this;
setTimeout(function(){
t.initAd?!!e&&e.call(t):t._whenGetAdSrc(e);
},500);
},AdPlugin.prototype.setSize=function(e){
var t=this,a=t.adPlayer;
a&&a.setVideoCSS(e);
},AdPlugin;
});function _typeof(e){
return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e;
}
define("new_video/plugin/proxy.js",["new_video/plugin_base.js","biz_wap/jsapi/core.js","pages/version4video.js"],function(e){
"use strict";
function i(e){
y.invoke("videoProxySetPlayerState",{
webviewVideoProxyPlayState:e
},function(){});
}
function o(e){
try{
1==parent.window.logs.video_cnt&&y.invoke("videoProxyStopPlay",{
webviewVideoProxyPlaydataId:e
},function(e){
console.log("videoProxyStopPlay resp: "+JSON.stringify(e));
});
}catch(i){}
}
function t(e,i,o){
i=i||"",i=["uin:"+parent.window.user_uin,"resp:"+i].join("|"),e=41>e&&u.device.is_ios?e+8:e;
try{
(o||w)&&((new window.Image).src="/mp/jsreport?key="+e+"&content="+i+"&r="+Math.random());
}catch(t){
if(window.__moon_report){
var r=[c.join(""),";userAgent:"+parent.window.navigator.userAgent];
window.__moon_report([{
offset:8,
log:r.join(""),
e:t
}]);
}
}
}
function r(e){
var i=u.device.is_ios?116:142,o=u.device.is_ios?x.ios:x.android;
y.invoke("reportIDKey",{
idKeyDataInfo:[{
id:i,
key:o[e],
value:"1"
}]
},function(){});
}
function n(e){
var i=0,o=+new Date-e;
o/=1e3,o>0&&1>=o?i=1:o>1&&3>=o?i=2:o>3&&7>=o?i=3:o>7&&15>=o?i=4:o>15&&(i=5),e&&i&&r(i);
}
function a(e){
if(e){
var i=0;
switch(e.code){
case S:
i=6;
break;

case h:
i=7;
break;

case m:
i=8;
break;

case I:
i=9;
}
i&&r(i);
}
}
function l(e){
b++,y.invoke("videoProxyInit",{},function(i){
try{
console.log("videoProxyInit callback,resp:"+JSON.stringify(i));
}catch(o){}
return 3>b&&u.device.is_android&&(!i.err_msg||-1==i.err_msg.indexOf("videoProxyInit"))?void l(e):void e(i);
});
}
var s,c=["modle_init_typeof_image:","undefined"==typeof Image?"undefined":_typeof(Image),";modle_init_typeof_winimage:",_typeof(window.Image),";modle_init_typeof_topwinimage:",_typeof(parent.window.Image)],d=e("new_video/plugin_base.js"),y=e("biz_wap/jsapi/core.js"),u=e("pages/version4video.js"),p=parent.window.navigator.userAgent.match(/MicroMessenger\/((\d+)(\.\d+)*)/),f=p&&p[1]||0,v=5,P=6,_=7,g=8,w=Math.random()>.75,x={
ios:[2,3,4,5,6,7,12,13,14,15],
android:[45,40,41,42,43,44,50,51,52,53]
},S=1,h=2,m=3,I=4,b=0;
s="object"==_typeof(parent.window._playerProxyPluginData)?parent.window._playerProxyPluginData:parent.window._playerProxyPluginData={
callbacks:[],
hasInited:!1,
initing:!1,
initResult:"default"
},!u.isUseProxy()||s.hasInited||s.initing||(s.initing=!0,t(32),l(function(e){
s.hasInited=!0,0==e.videoProxyInitResult?s.initResult="success":(s.initResult="fail",
u.modifyExper(!1,!0));
for(var i=s.callbacks,o=null;o=i.shift();)o&&"function"==typeof o._getLocalSrc&&o._getLocalSrc();
t(41),e.err_msg&&e.err_msg.indexOf("function_not_exist")>0&&t(28),e.err_msg&&-1!=e.err_msg.indexOf("function_not_exist")||0==e.videoProxyInitResult||t(29,JSON.stringify(e),!0);
}));
var T=function(e){
var i=this,o=e.data;
i.cdnUrl=e.cdn_url,i.fileId=e.vid+"."+o.formatid,i.fileSize=o.file_size,i.duration=1*o.time|0,
i.lastWaiting=0,i.useProxy=u.isUseProxy(),i._whenInit(),t(25),y.on("onH5VideoProxyReInit",function(e){
console.log("onH5VideoProxyReInit",e),0===e.videoProxyInitResult?y.invoke("videoProxyStartPlay",{
webviewVideoProxyCdnUrls:i.cdnUrl,
webviewVideoProxyFileId:i.fileId,
webviewVideoProxyFileSize:i.fileSize,
webviewVideoProxyFileDuration:i.duration,
webviewVideoProxyFileType:"1"
},function(e){
i.localSrc=e.videoProxyPlayLocalUrl,i.playId=e.videoProxyPlayDataId,i.player.setSrcWithTime(i.localSrc);
}):i.player.setSrcWithTime(i.cdnUrl);
});
};
return d.inherit(T,d.Class),T.prototype.init=function(){
this.hasInit=!1;
},T.prototype._getLocalSrc=function(){
var e=this;
"success"==s.initResult?(t(42),e._videoProxyStartPlayCallbacked=0,setTimeout(function(){
0==e._videoProxyStartPlayCallbacked&&t(43);
},2e3),y.invoke("videoProxyStartPlay",{
webviewVideoProxyCdnUrls:e.cdnUrl,
webviewVideoProxyFileId:e.fileId,
webviewVideoProxyFileSize:e.fileSize,
webviewVideoProxyFileDuration:e.duration,
webviewVideoProxyFileType:"1"
},function(i){
e.localSrc=i.videoProxyPlayLocalUrl,e.playId=i.videoProxyPlayDataId,e.useProxy=!!e.localSrc,
e.__getLocalSrcCallback&&e.__getLocalSrcCallback(),e.useProxy?t(26):t(30,JSON.stringify(i),!0),
e._videoProxyStartPlayCallbacked=1;
})):(e.useProxy=!1,e.__getLocalSrcCallback&&e.__getLocalSrcCallback());
},T.prototype._whenInit=function(){
var e=this;
s.hasInited?e._getLocalSrc():s.callbacks.push(e);
},T.prototype._whenGetLocalSrc=function(e){
var i=this;
i.localSrc||!i.useProxy?(e&&setTimeout(e,1),i.__getLocalSrcCallback=null):i.__getLocalSrcCallback=e;
},T.prototype.preload=function(e){
var i=this;
if(f>="6.3")y.invoke("videoProxyPreload",{
webviewVideoProxyPlaydataId:i.playId,
webviewVideoProxyPreloadTime:""+e
},function(o){
try{
console.log("videoProxyPreload callback,playId:"+i.playId+",sec:"+e+",resp:"+JSON.stringify(o));
}catch(t){}
o.err_msg.indexOf("videoProxyPreload:ok");
});else{
var o;
!function(){
var t=function r(){
o.buffered.length&&o.buffered.end(0)>e&&(o.removeEventListener("progress",r),o=null);
};
o=document.createElement("video"),o.setAttribute("src",i.localSrc||i.cdnUrl),o.setAttribute("preload","auto"),
o.addEventListener("progress",t);
}();
}
t(45);
},T.prototype.preloadHandler=function(){
var e=this;
return u.isUseAd()&&-1==parent.window.location.search.indexOf("&preload=0")&&e._whenGetLocalSrc(function(){
e.preload(10);
}),d.BASE_BITSET;
},T.prototype.loadingHandler=function(e,i){
var o=this,t=o.player;
return o.hasInit||!o.useProxy?d.BASE_BITSET:(o._whenGetLocalSrc(function(){
o.hasInit=!0,o.localSrc?(u.proxyPreloadExper()&&u.proxyPreloadExper().isUsePreload&&t.setSrc(o.localSrc),
t._trigger("loaded",{
autoplay:i&&i.autoplay
})):t._trigger("loading",i);
}),t.showLoading(),14);
},T.prototype.readyBeginPlayHandler=function(){
var e=this,i=this.player;
return e.useProxy?(i.setSrc(this.localSrc),i._trigger("beginPlay"),14):d.BASE_BITSET;
},T.prototype._getRemainTime=function(){
for(var e=this.player.video,i=e.currentTime,o=e.buffered,t=o&&o.length||0,r=0;t>r;r++){
var n=o.start(r),a=o.end(r);
if(i>=n&&a>=i){
var l=a-i;
return l;
}
}
},T.prototype._syncRemainTime=function(){
var e=this,i=0|e._getRemainTime();
y.invoke("videoProxySetRemainTime",{
webviewVideoProxyPlaydataId:e.playId,
webviewVideoProxyRemainTime:i||0
},function(){}),e.remainTimer=setTimeout(function(){
e._syncRemainTime();
},1e3);
},T.prototype.canplayHandler=function(){
return this.useProxy&&(this.canPlay=!0),d.BASE_BITSET;
},T.prototype.beginPlayHandler=function(){
{
var e=this,i=e.player;
i._getContainer(),i.video;
}
return e.useProxy&&(e.remainTimer=setTimeout(function(){
e._syncRemainTime();
},1e3),t(27),this.setPlayBufferCnt=0),d.BASE_BITSET;
},T.prototype.playHandler=function(){
return this.useProxy&&(i(P),this.canPlay&&n(this.lastWaiting),this.lastWaiting=0),
d.BASE_BITSET;
},T.prototype.replayHandler=function(){
var e=this;
return e.useProxy?(e.localSrc="",e._whenInit(),e._whenGetLocalSrc(function(){
e.player.setSrc(e.localSrc||e.cdnUrl),e.player._afterReplay();
}),14):d.BASE_BITSET;
},T.prototype.pauseHandler=function(){
return this.useProxy&&i(v),d.BASE_BITSET;
},T.prototype.waitingHandler=function(){
return this.useProxy&&this.canPlay&&(i(_),this.setPlayBufferCnt++,this.lastWaiting=+new Date,
r(0)),console.log("waiting event triggered in proxy plugin.",this.useProxy,this.canPlay),
d.BASE_BITSET;
},T.prototype.errorHandler=function(){
var e=this,r=this.player;
return this.useProxy&&(i(g),a(r.video&&r.video.error),t(31,null,!0),o(e.playId)),
d.BASE_BITSET;
},T.prototype.endHandler=function(){
{
var e=this;
e.player;
}
if(e.useProxy){
clearTimeout(e.remainTimer);
var i=this.setPlayBufferCnt+72;
i=i>78?78:i,t(i,null,!0);
}
return d.BASE_BITSET;
},T;
});define("biz_common/dom/attr.js",[],function(){
"use strict";
function t(t,e,n){
return"undefined"==typeof n?t.getAttribute(e):t.setAttribute(e,n);
}
function e(t,e,n,r){
t.style.setProperty?(r=r||null,t.style.setProperty(e,n,r)):"undefined"!=typeof t.style.cssText&&(r=r?"!"+r:"",
t.style.cssText+=";"+e+":"+n+r+";");
}
return{
attr:t,
setProperty:e
};
});define("biz_wap/utils/localstorage.js",[],function(){
"use strict";
var t={};
return t=window.localStorage?{
set:function(t,e){
null!==this.get(t)&&this.remove(t),localStorage.setItem(t,e);
},
get:function(t){
var e=localStorage.getItem(t);
return void 0===e?null:e;
},
remove:function(t){
localStorage.removeItem(t);
},
clear:function(){
localStorage.clear();
},
each:function(t){
for(var e,o=localStorage.length,n=0,t=t||function(){};o>n&&(e=localStorage.key(n),
t.call(this,e,this.get(e))!==!1);n++)localStorage.length<o&&(o--,n--);
}
}:{
set:function(){},
get:function(){},
remove:function(){},
clear:function(){},
each:function(){}
};
});define("pages/video_plugin/video_monitor.js",["pages/video_plugin/base.js","biz_wap/utils/jsmonitor_report.js","appmsg/log.js"],function(t){
"use strict";
function r(){
this._g={
reportData:{},
uid:+new Date,
random:Math.random(),
_debug:window.parent.window.location.href.indexOf("&vconsole=1")>0?!0:!1
};
}
var i=t("pages/video_plugin/base.js"),a=t("biz_wap/utils/jsmonitor_report.js"),o=t("appmsg/log.js");
return i.inherit(r,i.Class),r.prototype.init=function(){
this.setBlockEvt("initMonitor");
},r.prototype.getuid=function(){
return++this._g.uid;
},r.prototype.initDataByUid=function(t,r){
var i=this._g.reportData;
!r&&i[t]&&i[t].radio&&(r=i[t].radio),this._g.reportData[t]={
data:{},
radio:r||1
};
},r.prototype.initMonitorHandler=function(t,r,i){
var a=this.getuid()+"_"+r;
return this.initDataByUid(a,i),{
data:a,
code:7
};
},r.prototype.minusMonitorHandler=function(t,r,a){
var o=this._g.reportData[r];
if(!o||!a)return i.BASE_BITSET;
o=o.data;
for(var e in a){
var n=a[e];
a.hasOwnProperty(e)&&(o[e]||(o[e]={
key:e,
value:0
}),o[e].value=Math.max(0,o[e].value-n||1));
}
return i.BASE_BITSET;
},r.prototype.setMonitorHandler=function(t,r,a){
var o=this._g.reportData[r];
if(!o||!a)return i.BASE_BITSET;
o=o.data;
for(var e in a){
var n=a[e];
a.hasOwnProperty(e)&&(o[e]||(o[e]={
key:e,
value:0
}),o[e].value=n||1);
}
return i.BASE_BITSET;
},r.prototype.plusMonitorHandler=function(t,r,a){
var o=this._g.reportData[r];
if(!o||!a)return i.BASE_BITSET;
o=o.data;
for(var e in a)if(a.hasOwnProperty(e)){
var n=a[e];
o[e]||(o[e]={
key:e,
value:0
}),o[e].value=o[e].value+n||1;
}
return i.BASE_BITSET;
},r.prototype.clearMonitorHandler=function(t,r){
return this.initDataByUid(r),i.BASE_BITSET;
},r.prototype.sendMonitorHandler=function(t,r){
if(!r||-1==r.indexOf("_"))return i.BASE_BITSET;
var e=this._g.reportData[r];
if(!e)return i.BASE_BITSET;
if(this._g.random>e.radio&&!this._g._debug)return i.BASE_BITSET;
e=e.data;
var n=(r+"").split("_")[1];
for(var s in e)if(e.hasOwnProperty(s)){
var u=e[s];
u.value&&a.setSum(n,u.key,u.value);
}
return o("[Video] "+JSON.stringify(e)),this.initDataByUid(r),i.BASE_BITSET;
},r;
});define("pages/iframe_communicate.js",["biz_common/dom/event.js","biz_common/dom/attr.js","pages/video_ctrl.js"],function(e){
"use strict";
function t(){
window.addEventListener("message",o,!1);
}
function o(e){
var t;
if(e.origin?t=e.origin:e.originalEvent&&(t=e.originalEvent.origin),/^http(s)?\:\/\/mp\.weixin\.qq\.com$/.test(t)&&e.source){
var o=e.data;
if(o&&o.type){
if(!/^mpvideo_/.test(o.type))return;
for(var s=o.type.replace(/^mpvideo_/,""),a=p.postMessageEvt[s]||[],i=0;i<a.length;i++)a[i].func(o.data);
}
}
}
function s(e){
var t=e.type;
/^mpvideo_/.test(t)||(t="mpvideo_"+t);
var o={
data:e.data,
type:t
};
window.parent.postMessage(o,document.location.protocol+"//mp.weixin.qq.com");
}
function a(e){
var t=e.type;
/^broadcast_/.test(t)||(t="broadcast_"+t),s({
type:t,
data:e.data
});
}
function i(e){
var t=e.type;
/^mpvideo_/.test(t)&&(t=t.replace(/^mpvideo_/,"")),p.postMessageEvt[t]||(p.postMessageEvt[t]=[]),
p.postMessageEvt[t].push({
func:e.func
});
}
function n(e){
var t=e.type;
/^mpvideo_/.test(t)&&(t=t.replace(/^mpvideo_/,""));
for(var o=p.postMessageEvt[t]||[],s=0;s<o.length;s++)o[s].func===e.func&&(o.splice(s,1),
s--);
}
var r=(e("biz_common/dom/event.js"),e("biz_common/dom/attr.js")),p=(e("pages/video_ctrl.js"),
r.setProperty,{
postMessageEvt:{}
});
return t(),{
broadcastMessage:a,
postMessage:s,
addListener:i,
removeListener:n
};
});define("biz_wap/zepto/touch.js",["biz_wap/zepto/zepto.js"],function(e){
"use strict";
e("biz_wap/zepto/zepto.js"),function(e){
function t(e,t,o,n){
return Math.abs(e-t)>=Math.abs(o-n)?e-t>0?"Left":"Right":o-n>0?"Up":"Down";
}
function o(){
p=null,g.last&&(g.el&&"function"==typeof g.el.trigger&&g.el.trigger("longTap"),g={});
}
function n(){
p&&clearTimeout(p),p=null;
}
function i(){
a&&clearTimeout(a),l&&clearTimeout(l),c&&clearTimeout(c),p&&clearTimeout(p),a=l=c=p=null,
g={};
}
function r(e){
return("touch"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary;
}
function u(e,t){
return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t;
}
var a,l,c,p,s,g={},f=750;
e(document).ready(function(){
var w,y,T,h,d=0,m=0;
"MSGesture"in window&&(s=new MSGesture,s.target=document.body),e(document).bind("MSGestureEnd",function(e){
var t=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;
t&&g.el&&"function"==typeof g.el.trigger&&(g.el.trigger("swipe"),g.el.trigger("swipe"+t));
}).on("touchstart MSPointerDown pointerdown",function(t){
(!(h=u(t,"down"))||r(t))&&(T=h?t:t.touches[0],t.touches&&1===t.touches.length&&g.x2&&(g.x2=void 0,
g.y2=void 0),w=Date.now(),y=w-(g.last||w),g.el=e("tagName"in T.target?T.target:T.target.parentNode),
a&&clearTimeout(a),g.x1=T.pageX,g.y1=T.pageY,y>0&&250>=y&&(g.isDoubleTap=!0),g.last=w,
p=setTimeout(o,f),s&&h&&s.addPointer(t.pointerId));
}).on("touchmove MSPointerMove pointermove",function(e){
(!(h=u(e,"move"))||r(e))&&(T=h?e:e.touches[0],n(),g.x2=T.pageX,g.y2=T.pageY,d+=Math.abs(g.x1-g.x2),
m+=Math.abs(g.y1-g.y2));
}).on("touchend MSPointerUp pointerup",function(o){
(!(h=u(o,"up"))||r(o))&&(n(),g.x2&&Math.abs(g.x1-g.x2)>30||g.y2&&Math.abs(g.y1-g.y2)>30?c=setTimeout(function(){
g.el&&"function"==typeof g.el.trigger&&(g.el.trigger("swipe"),g.el.trigger("swipe"+t(g.x1,g.x2,g.y1,g.y2))),
g={};
},0):"last"in g&&(30>d&&30>m?l=setTimeout(function(){
var t=e.Event("tap");
t.cancelTouch=i,g.el&&"function"==typeof g.el.trigger&&g.el.trigger(t),g.isDoubleTap?(g.el&&g.el.trigger("doubleTap"),
g={}):a=setTimeout(function(){
a=null,g.el&&g.el.trigger("singleTap"),g={};
},250);
},0):g={}),d=m=0);
}).on("touchcancel MSPointerCancel pointercancel",i),e(window).on("scroll",i);
}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){
e.fn[t]=function(e){
return this.on(t,e);
};
});
}(Zepto);
});define("biz_wap/zepto/event.js",["biz_wap/zepto/zepto.js"],function(e){
"use strict";
e("biz_wap/zepto/zepto.js"),function(e){
function n(e){
return e._zid||(e._zid=d++);
}
function t(e,t,o,u){
if(t=r(t),t.ns)var a=i(t.ns);
return(g[n(e)]||[]).filter(function(e){
return!(!e||t.e&&e.e!=t.e||t.ns&&!a.test(e.ns)||o&&n(e.fn)!==n(o)||u&&e.sel!=u);
});
}
function r(e){
var n=(""+e).split(".");
return{
e:n[0],
ns:n.slice(1).sort().join(" ")
};
}
function i(e){
return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)");
}
function o(e,n){
return e.del&&!y&&e.e in E||!!n;
}
function u(e){
return b[e]||y&&E[e]||e;
}
function a(t,i,a,s,f,d,l){
var v=n(t),h=g[v]||(g[v]=[]);
i.split(/\s/).forEach(function(n){
if("ready"==n)return e(document).ready(a);
var i=r(n);
i.fn=a,i.sel=f,i.e in b&&(a=function(n){
var t=n.relatedTarget;
return!t||t!==this&&!e.contains(this,t)?i.fn.apply(this,arguments):void 0;
}),i.del=d;
var v=d||a;
i.proxy=function(e){
if(e=c(e),!e.isImmediatePropagationStopped()){
e.customData=s;
var n=v.apply(t,e._args==p?[e]:[e].concat(e._args));
return n===!1&&(e.preventDefault(),e.stopPropagation()),n;
}
},i.i=h.length,h.push(i),"addEventListener"in t&&t.addEventListener(u(i.e),i.proxy,o(i,l));
});
}
function s(e,r,i,a,s){
var c=n(e);
(r||"").split(/\s/).forEach(function(n){
t(e,n,i,a).forEach(function(n){
delete g[c][n.i],"removeEventListener"in e&&e.removeEventListener(u(n.e),n.proxy,o(n,s));
});
});
}
function c(n,t){
return(t||!n.isDefaultPrevented)&&(t||(t=n),e.each(_,function(e,r){
var i=t[e];
n[e]=function(){
return this[r]=P,i&&i.apply(t,arguments);
},n[r]=z;
}),(t.defaultPrevented!==p?t.defaultPrevented:"returnValue"in t?t.returnValue===!1:t.getPreventDefault&&t.getPreventDefault())&&(n.isDefaultPrevented=P)),
n;
}
function f(e){
var n,t={
originalEvent:e
};
for(n in e)w.test(n)||e[n]===p||(t[n]=e[n]);
return c(t,e);
}
var p,d=(e.zepto.qsa,1),l=Array.prototype.slice,v=e.isFunction,h=function(e){
return"string"==typeof e;
},g={},m={},y="onfocusin"in window,E={
focus:"focusin",
blur:"focusout"
},b={
mouseenter:"mouseover",
mouseleave:"mouseout"
};
m.click=m.mousedown=m.mouseup=m.mousemove="MouseEvents",e.event={
add:a,
remove:s
},e.proxy=function(t,r){
if(v(t)){
var i=function(){
return t.apply(r,arguments);
};
return i._zid=n(t),i;
}
if(h(r))return e.proxy(t[r],t);
throw new TypeError("expected function");
},e.fn.bind=function(e,n,t){
return this.on(e,n,t);
},e.fn.unbind=function(e,n){
return this.off(e,n);
},e.fn.one=function(e,n,t,r){
return this.on(e,n,t,r,1);
};
var P=function(){
return!0;
},z=function(){
return!1;
},w=/^([A-Z]|returnValue$|layer[XY]$)/,_={
preventDefault:"isDefaultPrevented",
stopImmediatePropagation:"isImmediatePropagationStopped",
stopPropagation:"isPropagationStopped"
};
e.fn.delegate=function(e,n,t){
return this.on(n,e,t);
},e.fn.undelegate=function(e,n,t){
return this.off(n,e,t);
},e.fn.live=function(n,t){
return e(document.body).delegate(this.selector,n,t),this;
},e.fn.die=function(n,t){
return e(document.body).undelegate(this.selector,n,t),this;
},e.fn.on=function(n,t,r,i,o){
var u,c,d=this;
return n&&!h(n)?(e.each(n,function(e,n){
d.on(e,t,r,n,o);
}),d):(h(t)||v(i)||i===!1||(i=r,r=t,t=p),(v(r)||r===!1)&&(i=r,r=p),i===!1&&(i=z),
d.each(function(p,d){
o&&(u=function(e){
return s(d,e.type,i),i.apply(this,arguments);
}),t&&(c=function(n){
var r,o=e(n.target).closest(t,d).get(0);
return o&&o!==d?(r=e.extend(f(n),{
currentTarget:o,
liveFired:d
}),(u||i).apply(o,[r].concat(l.call(arguments,1)))):void 0;
}),a(d,n,i,r,t,c||u);
}));
},e.fn.off=function(n,t,r){
var i=this;
return n&&!h(n)?(e.each(n,function(e,n){
i.off(e,t,n);
}),i):(h(t)||v(r)||r===!1||(r=t,t=p),r===!1&&(r=z),i.each(function(){
s(this,n,r,t);
}));
},e.fn.trigger=function(n,t){
return n=h(n)||e.isPlainObject(n)?e.Event(n):c(n),n._args=t,this.each(function(){
"dispatchEvent"in this?this.dispatchEvent(n):e(this).triggerHandler(n,t);
});
},e.fn.triggerHandler=function(n,r){
var i,o;
return this.each(function(u,a){
i=f(h(n)?e.Event(n):n),i._args=r,i.target=a,e.each(t(a,n.type||n),function(e,n){
return o=n.proxy(i),i.isImmediatePropagationStopped()?!1:void 0;
});
}),o;
},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(n){
e.fn[n]=function(e){
return e?this.bind(n,e):this.trigger(n);
};
}),["focus","blur"].forEach(function(n){
e.fn[n]=function(e){
return e?this.bind(n,e):this.each(function(){
try{
this[n]();
}catch(e){}
}),this;
};
}),e.Event=function(e,n){
h(e)||(n=e,e=n.type);
var t=document.createEvent(m[e]||"Events"),r=!0;
if(n)for(var i in n)"bubbles"==i?r=!!n[i]:t[i]=n[i];
return t.initEvent(e,r,!0),c(t);
};
}(Zepto);
});define("biz_wap/zepto/zepto.js",[],function(){
"use strict";
var t=function(){
function t(t){
return null==t?String(t):J[W.call(t)]||"object";
}
function n(n){
return"function"==t(n);
}
function e(t){
return null!=t&&t==t.window;
}
function i(t){
return null!=t&&t.nodeType==t.DOCUMENT_NODE;
}
function r(n){
return"object"==t(n);
}
function o(t){
return r(t)&&!e(t)&&Object.getPrototypeOf(t)==Object.prototype;
}
function s(t){
return t instanceof Array;
}
function u(t){
return"number"==typeof t.length;
}
function c(t){
return P.call(t,function(t){
return null!=t;
});
}
function a(t){
return t.length>0?C.fn.concat.apply([],t):t;
}
function l(t){
return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase();
}
function f(t){
return t in M?M[t]:M[t]=new RegExp("(^|\\s)"+t+"(\\s|$)");
}
function h(t,n){
return"number"!=typeof n||z[l(t)]?n:n+"px";
}
function p(t){
var n,e;
return j[t]||(n=L.createElement(t),L.body.appendChild(n),e=getComputedStyle(n,"").getPropertyValue("display"),
n.parentNode.removeChild(n),"none"==e&&(e="block"),j[t]=e),j[t];
}
function d(t){
return"children"in t?$.call(t.children):C.map(t.childNodes,function(t){
return 1==t.nodeType?t:void 0;
});
}
function g(t,n,e){
for(E in n)e&&(o(n[E])||s(n[E]))?(o(n[E])&&!o(t[E])&&(t[E]={}),s(n[E])&&!s(t[E])&&(t[E]=[]),
g(t[E],n[E],e)):n[E]!==x&&(t[E]=n[E]);
}
function m(t,n){
return null==n?C(t):C(t).filter(n);
}
function v(t,e,i,r){
return n(e)?e.call(t,i,r):e;
}
function y(t,n,e){
null==e?t.removeAttribute(n):t.setAttribute(n,e);
}
function b(t,n){
var e=t.className,i=e&&e.baseVal!==x;
return n===x?i?e.baseVal:e:void(i?e.baseVal=n:t.className=n);
}
function w(t){
var n;
try{
return t?"true"==t||("false"==t?!1:"null"==t?null:/^0/.test(t)||isNaN(n=Number(t))?/^[\[\{]/.test(t)?C.parseJSON(t):t:n):t;
}catch(e){
return t;
}
}
function N(t,n){
n(t);
for(var e in t.childNodes)N(t.childNodes[e],n);
}
var x,E,C,O,T,S,A=[],$=A.slice,P=A.filter,L=window.document,j={},M={},z={
"column-count":1,
columns:1,
"font-weight":1,
"line-height":1,
opacity:1,
"z-index":1,
zoom:1
},Z=/^\s*<(\w+|!)[^>]*>/,q=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,B=/^(?:body|html)$/i,R=/([A-Z])/g,V=["val","css","html","text","data","width","height","offset"],F=["after","prepend","before","append"],H=L.createElement("table"),I=L.createElement("tr"),U={
tr:L.createElement("tbody"),
tbody:H,
thead:H,
tfoot:H,
td:I,
th:I,
"*":L.createElement("div")
},_=/complete|loaded|interactive/,D=/^[\w-]*$/,J={},W=J.toString,X={},Y=L.createElement("div"),G={
tabindex:"tabIndex",
readonly:"readOnly",
"for":"htmlFor",
"class":"className",
maxlength:"maxLength",
cellspacing:"cellSpacing",
cellpadding:"cellPadding",
rowspan:"rowSpan",
colspan:"colSpan",
usemap:"useMap",
frameborder:"frameBorder",
contenteditable:"contentEditable"
};
X.matches=function(t,n){
if(!n||!t||1!==t.nodeType)return!1;
var e=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;
if(e)return e.call(t,n);
var i,r=t.parentNode,o=!r;
return o&&(r=Y).appendChild(t),i=~X.qsa(r,n).indexOf(t),o&&Y.removeChild(t),i;
},T=function(t){
return t.replace(/-+(.)?/g,function(t,n){
return n?n.toUpperCase():"";
});
},S=function(t){
return P.call(t,function(n,e){
return t.indexOf(n)==e;
});
},X.fragment=function(t,n,e){
var i,r,s;
return q.test(t)&&(i=C(L.createElement(RegExp.$1))),i||(t.replace&&(t=t.replace(k,"<$1></$2>")),
n===x&&(n=Z.test(t)&&RegExp.$1),n in U||(n="*"),s=U[n],s.innerHTML=""+t,i=C.each($.call(s.childNodes),function(){
s.removeChild(this);
})),o(e)&&(r=C(i),C.each(e,function(t,n){
V.indexOf(t)>-1?r[t](n):r.attr(t,n);
})),i;
},X.Z=function(t,n){
t=t||[];
for(var e in C.fn)t[e]=C.fn[e];
return t.selector=n||"",t;
},X.isZ=function(t){
return t instanceof X.Z;
},X.init=function(t,e){
var i;
if(!t)return X.Z();
if("string"==typeof t)if(t=t.trim(),"<"==t[0]&&Z.test(t))i=X.fragment(t,RegExp.$1,e),
t=null;else{
if(e!==x)return C(e).find(t);
i=X.qsa(L,t);
}else{
if(n(t))return C(L).ready(t);
if(X.isZ(t))return t;
if(s(t))i=c(t);else if(r(t))i=[t],t=null;else if(Z.test(t))i=X.fragment(t.trim(),RegExp.$1,e),
t=null;else{
if(e!==x)return C(e).find(t);
i=X.qsa(L,t);
}
}
return X.Z(i,t);
},C=function(t,n){
return X.init(t,n);
},C.extend=function(t){
var n,e=$.call(arguments,1);
return"boolean"==typeof t&&(n=t,t=e.shift()),e.forEach(function(e){
g(t,e,n);
}),t;
},X.qsa=function(t,n){
var e,r="#"==n[0],o=!r&&"."==n[0],s=r||o?n.slice(1):n,u=D.test(s);
return i(t)&&u&&r?(e=t.getElementById(s))?[e]:[]:1!==t.nodeType&&9!==t.nodeType?[]:$.call(u&&!r?o?t.getElementsByClassName(s):t.getElementsByTagName(n):t.querySelectorAll(n));
},C.contains=function(t,n){
return t!==n&&t.contains(n);
},C.type=t,C.isFunction=n,C.isWindow=e,C.isArray=s,C.isPlainObject=o,C.isEmptyObject=function(t){
var n;
for(n in t)return!1;
return!0;
},C.inArray=function(t,n,e){
return A.indexOf.call(n,t,e);
},C.camelCase=T,C.trim=function(t){
return null==t?"":String.prototype.trim.call(t);
},C.uuid=0,C.support={},C.expr={},C.map=function(t,n){
var e,i,r,o=[];
if(u(t))for(i=0;i<t.length;i++)e=n(t[i],i),null!=e&&o.push(e);else for(r in t)e=n(t[r],r),
null!=e&&o.push(e);
return a(o);
},C.each=function(t,n){
var e,i;
if(u(t)){
for(e=0;e<t.length;e++)if(n.call(t[e],e,t[e])===!1)return t;
}else for(i in t)if(n.call(t[i],i,t[i])===!1)return t;
return t;
},C.grep=function(t,n){
return P.call(t,n);
},window.JSON&&(C.parseJSON=JSON.parse),C.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,n){
J["[object "+n+"]"]=n.toLowerCase();
}),C.fn={
forEach:A.forEach,
reduce:A.reduce,
push:A.push,
sort:A.sort,
indexOf:A.indexOf,
concat:A.concat,
map:function(t){
return C(C.map(this,function(n,e){
return t.call(n,e,n);
}));
},
slice:function(){
return C($.apply(this,arguments));
},
ready:function(t){
return _.test(L.readyState)&&L.body?t(C):L.addEventListener("DOMContentLoaded",function(){
t(C);
},!1),this;
},
get:function(t){
return t===x?$.call(this):this[t>=0?t:t+this.length];
},
toArray:function(){
return this.get();
},
size:function(){
return this.length;
},
remove:function(){
return this.each(function(){
null!=this.parentNode&&this.parentNode.removeChild(this);
});
},
each:function(t){
return A.every.call(this,function(n,e){
return t.call(n,e,n)!==!1;
}),this;
},
filter:function(t){
return n(t)?this.not(this.not(t)):C(P.call(this,function(n){
return X.matches(n,t);
}));
},
add:function(t,n){
return C(S(this.concat(C(t,n))));
},
is:function(t){
return this.length>0&&X.matches(this[0],t);
},
not:function(t){
var e=[];
if(n(t)&&t.call!==x)this.each(function(n){
t.call(this,n)||e.push(this);
});else{
var i="string"==typeof t?this.filter(t):u(t)&&n(t.item)?$.call(t):C(t);
this.forEach(function(t){
i.indexOf(t)<0&&e.push(t);
});
}
return C(e);
},
has:function(t){
return this.filter(function(){
return r(t)?C.contains(this,t):C(this).find(t).size();
});
},
eq:function(t){
return-1===t?this.slice(t):this.slice(t,+t+1);
},
first:function(){
var t=this[0];
return t&&!r(t)?t:C(t);
},
last:function(){
var t=this[this.length-1];
return t&&!r(t)?t:C(t);
},
find:function(t){
var n,e=this;
return n="object"==typeof t?C(t).filter(function(){
var t=this;
return A.some.call(e,function(n){
return C.contains(n,t);
});
}):1==this.length?C(X.qsa(this[0],t)):this.map(function(){
return X.qsa(this,t);
});
},
closest:function(t,n){
var e=this[0],r=!1;
for("object"==typeof t&&(r=C(t));e&&!(r?r.indexOf(e)>=0:X.matches(e,t));)e=e!==n&&!i(e)&&e.parentNode;
return C(e);
},
parents:function(t){
for(var n=[],e=this;e.length>0;)e=C.map(e,function(t){
return(t=t.parentNode)&&!i(t)&&n.indexOf(t)<0?(n.push(t),t):void 0;
});
return m(n,t);
},
parent:function(t){
return m(S(this.pluck("parentNode")),t);
},
children:function(t){
return m(this.map(function(){
return d(this);
}),t);
},
contents:function(){
return this.map(function(){
return $.call(this.childNodes);
});
},
siblings:function(t){
return m(this.map(function(t,n){
return P.call(d(n.parentNode),function(t){
return t!==n;
});
}),t);
},
empty:function(){
return this.each(function(){
this.innerHTML="";
});
},
pluck:function(t){
return C.map(this,function(n){
return n[t];
});
},
show:function(){
return this.each(function(){
"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=p(this.nodeName));
});
},
replaceWith:function(t){
return this.before(t).remove();
},
wrap:function(t){
var e=n(t);
if(this[0]&&!e)var i=C(t).get(0),r=i.parentNode||this.length>1;
return this.each(function(n){
C(this).wrapAll(e?t.call(this,n):r?i.cloneNode(!0):i);
});
},
wrapAll:function(t){
if(this[0]){
C(this[0]).before(t=C(t));
for(var n;(n=t.children()).length;)t=n.first();
C(t).append(this);
}
return this;
},
wrapInner:function(t){
var e=n(t);
return this.each(function(n){
var i=C(this),r=i.contents(),o=e?t.call(this,n):t;
r.length?r.wrapAll(o):i.append(o);
});
},
unwrap:function(){
return this.parent().each(function(){
C(this).replaceWith(C(this).children());
}),this;
},
clone:function(){
return this.map(function(){
return this.cloneNode(!0);
});
},
hide:function(){
return this.css("display","none");
},
toggle:function(t){
return this.each(function(){
var n=C(this);
(t===x?"none"==n.css("display"):t)?n.show():n.hide();
});
},
prev:function(t){
return C(this.pluck("previousElementSibling")).filter(t||"*");
},
next:function(t){
return C(this.pluck("nextElementSibling")).filter(t||"*");
},
html:function(t){
return 0===arguments.length?this.length>0?this[0].innerHTML:null:this.each(function(n){
var e=this.innerHTML;
C(this).empty().append(v(this,t,n,e));
});
},
text:function(t){
return 0===arguments.length?this.length>0?this[0].textContent:null:this.each(function(){
this.textContent=t===x?"":""+t;
});
},
attr:function(t,n){
var e;
return"string"==typeof t&&n===x?0==this.length||1!==this[0].nodeType?x:"value"==t&&"INPUT"==this[0].nodeName?this.val():!(e=this[0].getAttribute(t))&&t in this[0]?this[0][t]:e:this.each(function(e){
if(1===this.nodeType)if(r(t))for(E in t)y(this,E,t[E]);else y(this,t,v(this,n,e,this.getAttribute(t)));
});
},
removeAttr:function(t){
return this.each(function(){
1===this.nodeType&&y(this,t);
});
},
prop:function(t,n){
return t=G[t]||t,n===x?this[0]&&this[0][t]:this.each(function(e){
this[t]=v(this,n,e,this[t]);
});
},
data:function(t,n){
var e=this.attr("data-"+t.replace(R,"-$1").toLowerCase(),n);
return null!==e?w(e):x;
},
val:function(t){
return 0===arguments.length?this[0]&&(this[0].multiple?C(this[0]).find("option").filter(function(){
return this.selected;
}).pluck("value"):this[0].value):this.each(function(n){
this.value=v(this,t,n,this.value);
});
},
offset:function(t){
if(t)return this.each(function(n){
var e=C(this),i=v(this,t,n,e.offset()),r=e.offsetParent().offset(),o={
top:i.top-r.top,
left:i.left-r.left
};
"static"==e.css("position")&&(o.position="relative"),e.css(o);
});
if(0==this.length)return null;
var n=this[0].getBoundingClientRect();
return{
left:n.left+window.pageXOffset,
top:n.top+window.pageYOffset,
width:Math.round(n.width),
height:Math.round(n.height)
};
},
css:function(n,e){
if(arguments.length<2){
var i=this[0],r=getComputedStyle(i,"");
if(!i)return;
if("string"==typeof n)return i.style[T(n)]||r.getPropertyValue(n);
if(s(n)){
var o={};
return C.each(s(n)?n:[n],function(t,n){
o[n]=i.style[T(n)]||r.getPropertyValue(n);
}),o;
}
}
var u="";
if("string"==t(n))e||0===e?u=l(n)+":"+h(n,e):this.each(function(){
this.style.removeProperty(l(n));
});else for(E in n)n[E]||0===n[E]?u+=l(E)+":"+h(E,n[E])+";":this.each(function(){
this.style.removeProperty(l(E));
});
return this.each(function(){
this.style.cssText+=";"+u;
});
},
index:function(t){
return t?this.indexOf(C(t)[0]):this.parent().children().indexOf(this[0]);
},
hasClass:function(t){
return t?A.some.call(this,function(t){
return this.test(b(t));
},f(t)):!1;
},
addClass:function(t){
return t?this.each(function(n){
O=[];
var e=b(this),i=v(this,t,n,e);
i.split(/\s+/g).forEach(function(t){
C(this).hasClass(t)||O.push(t);
},this),O.length&&b(this,e+(e?" ":"")+O.join(" "));
}):this;
},
removeClass:function(t){
return this.each(function(n){
return t===x?b(this,""):(O=b(this),v(this,t,n,O).split(/\s+/g).forEach(function(t){
O=O.replace(f(t)," ");
}),void b(this,O.trim()));
});
},
toggleClass:function(t,n){
return t?this.each(function(e){
var i=C(this),r=v(this,t,e,b(this));
r.split(/\s+/g).forEach(function(t){
(n===x?!i.hasClass(t):n)?i.addClass(t):i.removeClass(t);
});
}):this;
},
scrollTop:function(t){
if(this.length){
var n="scrollTop"in this[0];
return t===x?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){
this.scrollTop=t;
}:function(){
this.scrollTo(this.scrollX,t);
});
}
},
scrollLeft:function(t){
if(this.length){
var n="scrollLeft"in this[0];
return t===x?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){
this.scrollLeft=t;
}:function(){
this.scrollTo(t,this.scrollY);
});
}
},
position:function(){
if(this.length){
var t=this[0],n=this.offsetParent(),e=this.offset(),i=B.test(n[0].nodeName)?{
top:0,
left:0
}:n.offset();
return e.top-=parseFloat(C(t).css("margin-top"))||0,e.left-=parseFloat(C(t).css("margin-left"))||0,
i.top+=parseFloat(C(n[0]).css("border-top-width"))||0,i.left+=parseFloat(C(n[0]).css("border-left-width"))||0,
{
top:e.top-i.top,
left:e.left-i.left
};
}
},
offsetParent:function(){
return this.map(function(){
for(var t=this.offsetParent||L.body;t&&!B.test(t.nodeName)&&"static"==C(t).css("position");)t=t.offsetParent;
return t;
});
}
},C.fn.detach=C.fn.remove,["width","height"].forEach(function(t){
var n=t.replace(/./,function(t){
return t[0].toUpperCase();
});
C.fn[t]=function(r){
var o,s=this[0];
return r===x?e(s)?s["inner"+n]:i(s)?s.documentElement["scroll"+n]:(o=this.offset())&&o[t]:this.each(function(n){
s=C(this),s.css(t,v(this,r,n,s[t]()));
});
};
}),F.forEach(function(n,e){
var i=e%2;
C.fn[n]=function(){
var n,r,o=C.map(arguments,function(e){
return n=t(e),"object"==n||"array"==n||null==e?e:X.fragment(e);
}),s=this.length>1;
return o.length<1?this:this.each(function(t,n){
r=i?n:n.parentNode,n=0==e?n.nextSibling:1==e?n.firstChild:2==e?n:null,o.forEach(function(t){
if(s)t=t.cloneNode(!0);else if(!r)return C(t).remove();
N(r.insertBefore(t,n),function(t){
null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML);
});
});
});
},C.fn[i?n+"To":"insert"+(e?"Before":"After")]=function(t){
return C(t)[n](this),this;
};
});
for(var K in C.fn)X.Z[K]=C.fn[K];
return X.uniq=S,X.deserializeValue=w,C.zepto=X,C;
}();
window.Zepto=t,void 0===window.$&&(window.$=t);
});define("new_video/ctl.js",["common/comm_report.js","biz_wap/utils/ajax.js"],function(e){
"use strict";
var i,n=e("common/comm_report.js");
if(parent==window)i=window;else try{
{
parent.window.location.href;
}
i=parent.window;
}catch(r){
i=window;
}
var t=i.user_uin,a=Math.floor(i.user_uin/100)%20;
t||(a=-1);
var o=function(){
return a>=0;
};
i.__webviewid||(i.__webviewid=+new Date+"_"+Math.ceil(1e3*Math.random()));
var d=function(){
var e=i.mid,n=i.idx,r="";
r=e&&n?e+"_"+n:"";
var a=i.__webviewid,o=[t,r,a].join("_");
return o;
},s=function(i){
if(20>a)try{
var n=i.vid||"",r={};
r.__biz=parent.window.biz||"",r.vid=n,r.clienttime=+new Date;
var t=parent.window.mid,s=parent.window.idx,p="";
p=t&&s?t+"_"+s:n,r.type="undefined"!=typeof i.type?i.type:t&&s?1:2,r.id=p,r.hit_bizuin=i.hit_bizuin||"",
r.hit_vid=i.hit_vid||"",r.webviewid=d(),r.step=i.step||0,r.orderid=i.orderid||0,
r.ad_source=i.ad_source||0,r.traceid=i.traceid||0,r.ext1=i.ext1||"",r.ext2=i.ext2||"",
r.r=Math.random(),r.devicetype=parent.window.devicetype,r.version=parent.window.clientversion,
r.is_gray=o()?1:0,r.mid=t||"",r.idx=s||"",r.url=parent.window.location.href,r.screen_num=i.screen_num||0,
r.screen_height=i.screen_height||0,r.ori_status=i.ori_status||3,r.fromid=i.fromid||0,
r.sessionid=window.sessionid||"",r.appmsg_scene=window.source||(window.cgiData?window.cgiData.scene:0)||0,
!r.appmsg_scene&&r.fromid?r.appmsg_scene=r.fromid:!r.fromid&&r.appmsg_scene&&(r.fromid=r.appmsg_scene),
r.total_range=i.total_range||0,r.current_range=i.current_range||0,r.duration=i.duration||0;
var c=e("biz_wap/utils/ajax.js");
c({
url:"/mp/ad_video_report?action=user_action",
type:"post",
data:r
});
}catch(w){}
},p=function(e){
try{
var i=e.vid||"",r={};
r.BizUin=parent.window.biz||"",r.Vid=i,r.ClientTime=+new Date;
var t=parent.window.mid,a=parent.window.idx,s="";
s=t&&a?t+"_"+a:i,r.Type="undefined"!=typeof e.type?e.type:t&&a?1:2,r.Id=s,r.HitBizUin=parseInt(e.hit_bizuin)||0,
r.HitVid=e.hit_vid||"",r.WebViewId=d(),r.Step=parseInt(e.step,10)||0,r.OrderId=(e.orderid||"").toString(),
r.AdSource=parseInt(e.ad_source,10)||0,r.TraceId=(e.traceid||"").toString(),r.Ext1=(e.ext1||"").toString(),
r.Ext2=(e.ext2||"").toString(),r.r=Math.random(),r.DeviceType=parent.window.devicetype,
r.ClientVersion=parseInt(parent.window.clientversion),r.IsGray=o()?1:0,r.msgid=parseInt(t,10)||0,
r.itemidx=parseInt(a,10)||0,r.Url=parent.window.location.href,r.ScreenNum=parseInt(e.screen_num,10)||0,
r.ScreenHeight=parseInt(e.screen_height,10)||0,r.OrStatus=parseInt(e.ori_status,10)||3,
r.Fromid=parseInt(e.fromid,10)||0,r.SessionId=(window.sessionid||"").toString(),
r.AppmsgScene=parseInt(window.source||(window.cgiData?window.cgiData.scene:0),10)||0,
!r.AppmsgScene&&r.Fromid?r.AppmsgScene=r.Fromid:!r.Fromid&&r.AppmsgScene&&(r.Fromid=r.AppmsgScene),
r.AppmsgScene=parseInt(r.AppmsgScene,10)||0,r.Fromid=parseInt(r.Fromid,10)||0,r.TotalRange=parseInt(e.total_range,10)||0,
r.CurrentRange=parseInt(e.current_range,10)||0,r.Duration=parseInt(e.duration,10)||0,
r.RemindTrafficSize=parseInt(e.remind_traffic_size,10)||0,r.TrafficReminderType=parseInt(e.traffic_reminder_type,10)||0,
n.report(12710,r);
}catch(p){}
};
return{
report:s,
getWebviewid:d,
showAd:o,
commReport:p
};
});define("biz_common/utils/monitor.js",[],function(){
"use strict";
function t(t,r){
if(null===t)return{};
for(var o={},e=Object.keys(t),n=0;n<e.length;n++){
var i=e[n];
r.indexOf(i)>=0||(o[i]=t[i]);
}
return o;
}
function r(t){
var r=[],o=null;
for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&r.push(o+"="+encodeURIComponent(t[o]));
return r.join("&");
}
var o=[],e="/mp/jsmonitor?#wechat_redirect",n={};
return window.__monitor?window.__monitor:(n._reportOptions={
idkey:{}
},n.getReportData=function(t){
t=t||{};
var r,e,i=n._reportOptions.idkey||{},p=null;
try{
for(p in i)Object.prototype.hasOwnProperty.call(i,p)&&i[p]&&o.push(p+"_"+i[p]);
}catch(a){
return!1;
}
if(0===o.length)return!1;
try{
var c=n._reportOptions;
if(null!==c&&void 0!==c)for(e in c)Object.prototype.hasOwnProperty.call(c,e)&&(r[e]=c[e]);
}catch(a){
r={};
}
return r.idkey=o.join(";"),r.t=Math.random(),t.remove!==!1&&(o=[],n._reportOptions={
idkey:{}
}),r;
},n.setLogs=function(r){
var o=r.id,e=r.key,i=r.value,p=t(r,["id","key","value"]),a=n._reportOptions.idkey||{},c=o+"_"+e;
a[c]?a[c]+=i:a[c]=i,n._reportOptions.idkey=a;
try{
if(null!==p&&void 0!==p)for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(n._reportOptions[s]=p[s]);
}catch(u){
console.log(u);
}
return n;
},n.setAvg=function(t,r,o){
var e=n._reportOptions.idkey||{},i=t+"_"+r,p=t+"_"+(r-1);
return e[i]?e[i]+=o:e[i]=o,e[p]?e[p]+=1:e[p]=1,n._reportOptions.idkey=e,n;
},n.setSum=function(t,r,o){
var e=n._reportOptions.idkey,i=t+"_"+r;
return e[i]?e[i]+=o:e[i]=o,n._reportOptions.idkey=e,n;
},n.send=function(t,o){
t!==!1&&(t=!0);
var i=n.getReportData();
i&&(o&&o instanceof Function?o({
url:e,
type:"POST",
mayAbort:!0,
data:i,
async:t,
timeout:2e3
}):(new Image).src=location.origin+"/mp/jsmonitor?"+r(i)+"#wechat_redirect");
},window.__monitor=n,n);
});define("biz_wap/utils/log.js",["biz_wap/utils/mmversion.js","biz_wap/jsapi/core.js"],function(i){
"use strict";
var s=i("biz_wap/utils/mmversion.js"),e=i("biz_wap/jsapi/core.js");
return function(i,n,o){
"string"!=typeof i&&(i=JSON.stringify(i)),n=n||"info",o=o||function(){};
var t;
s.isIOS?t="writeLog":s.isAndroid&&(t="log"),t&&e.invoke(t,{
level:n,
msg:"[WechatFe]"+i
},o);
};
});